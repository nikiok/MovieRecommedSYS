{"ast":null,"code":"import { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, createTextVNode as _createTextVNode, vShow as _vShow, withDirectives as _withDirectives, Transition as _Transition, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-e390846a\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"space mail\"\n};\nconst _hoisted_2 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"span\", null, \"绑定邮箱：\", -1 /* HOISTED */));\nconst _hoisted_3 = {\n  style: {\n    \"color\": \"rgb(147, 147, 147)\"\n  }\n};\nconst _hoisted_4 = /*#__PURE__*/_createTextVNode(\"修改 \");\nconst _hoisted_5 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"p\", {\n  style: {\n    \"width\": \"100%\",\n    \"text-align\": \"center\",\n    \"color\": \"red\"\n  }\n}, \"邮箱格式有误！\", -1 /* HOISTED */));\nconst _hoisted_6 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"br\", null, null, -1 /* HOISTED */));\nconst _hoisted_7 = {\n  class: \"space\"\n};\nconst _hoisted_8 = /*#__PURE__*/_createTextVNode(\"确 定\");\nconst _hoisted_9 = /*#__PURE__*/_createTextVNode(\"取 消\");\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_edit = _resolveComponent(\"edit\");\n  const _component_el_icon = _resolveComponent(\"el-icon\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_popover = _resolveComponent(\"el-popover\");\n  const _component_el_input = _resolveComponent(\"el-input\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createElementVNode(\"div\", _hoisted_1, [_hoisted_2, _createElementVNode(\"span\", _hoisted_3, _toDisplayString($setup.userMail), 1 /* TEXT */), _createElementVNode(\"span\", {\n    onClick: _cache[0] || (_cache[0] = $event => $setup.isShowMailEditing = !$setup.isShowMailEditing),\n    class: \"edit-btn\"\n  }, [_createVNode(_component_el_icon, null, {\n    default: _withCtx(() => [_createVNode(_component_edit)]),\n    _: 1 /* STABLE */\n  }), _hoisted_4])]), _createVNode(_Transition, {\n    duration: 300,\n    name: \"animate__animated animate__zoomOut\",\n    appear: \"\",\n    \"enter-active-class\": \"animate__fadeIn\",\n    \"leave-active-class\": \"animate__fadeOut \"\n  }, {\n    default: _withCtx(() => [_withDirectives(_createElementVNode(\"div\", null, [_createVNode(_component_el_input, {\n      modelValue: $setup.mail,\n      \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.mail = $event),\n      placeholder: \"请输入新邮箱\",\n      class: \"space input\"\n    }, {\n      append: _withCtx(() => [_createVNode(_component_el_popover, {\n        visible: $setup.isInputError,\n        placement: \"top\",\n        \"hide-after\": \"1000\"\n      }, {\n        reference: _withCtx(() => [_createVNode(_component_el_button, {\n          disabled: $setup.isDisabled,\n          onClick: $setup.sendAuthCode\n        }, {\n          default: _withCtx(() => [_createTextVNode(_toDisplayString($setup.sendCodeBtnName), 1 /* TEXT */)]),\n\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"disabled\", \"onClick\"])]),\n        default: _withCtx(() => [_hoisted_5]),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"visible\"])]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"modelValue\"]), _hoisted_6, _createVNode(_component_el_input, {\n      modelValue: $setup.authCode,\n      \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $setup.authCode = $event),\n      placeholder: \"验证码\",\n      class: \"space input\"\n    }, null, 8 /* PROPS */, [\"modelValue\"]), _createElementVNode(\"div\", _hoisted_7, [_createVNode(_component_el_button, {\n      onClick: $setup.updateMail,\n      type: \"primary\"\n    }, {\n      default: _withCtx(() => [_hoisted_8]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"onClick\"]), _createVNode(_component_el_button, {\n      onClick: _cache[3] || (_cache[3] = $event => $setup.isShowMailEditing = false)\n    }, {\n      default: _withCtx(() => [_hoisted_9]),\n      _: 1 /* STABLE */\n    })])], 512 /* NEED_PATCH */), [[_vShow, $setup.isShowMailEditing]])]),\n    _: 1 /* STABLE */\n  })], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"mappings":";;;EACOA,KAAK,EAAC;AAAY;gEACrBC,oBAAkB,cAAZ,OAAK;;EACLC,KAAiC,EAAjC;IAAA;EAAA;AAAiC;iDAGX,KAC5B;gEAaQD,oBAAmE;EAAhEC,KAAoD,EAApD;IAAA;IAAA;IAAA;EAAA;AAAoD,GAAC,SAAO;gEAQrED,oBAAK;;EAIAD,KAAK,EAAC;AAAO;iDAC8B,KAAG;iDACH,KAAG;;;;;;;6DAjCvDC,oBAOM,OAPNE,UAOM,GANJC,UAAkB,EAClBH,oBAA6D,QAA7DI,UAA6D,mBAAlBC,eAAQ,kBAEnDL,oBAEO;IAFAM,OAAK,sCAAED,wBAAiB,IAAIA,wBAAiB;IAAEN,KAAK,EAAC;MAC1DQ,aAA0BC;sBAAjB,MAAO,CAAPD,aAAOE;;sBAIpBF,aA2BaG;IA1BRC,QAAQ,EAAE,GAAG;IACdC,IAAI,EAAC,oCAAoC;IACzCC,MAAM,EAAN,EAAM;IACN,oBAAkB,EAAC,iBAAiB;IACpC,oBAAkB,EAAC;;sBACrB,MAoBM,iBApBNb,oBAoBM,cAnBJO,aASWO;kBATQT,WAAI;iEAAJA,WAAI;MAAEU,WAAW,EAAC,QAAQ;MAAChB,KAAK,EAAC;;MACvCiB,MAAM,WACf,MAKa,CALbT,aAKaU;QALAC,OAAO,EAAEb,mBAAY;QAAEc,SAAS,EAAC,KAAK;QAAC,YAAU,EAAC;;QAElDC,SAAS,WAClB,MAAyF,CAAzFb,aAAyFc;UAA7EC,QAAQ,EAAEjB,iBAAU;UAAGC,OAAK,EAAED;;4BAAc,MAAqB,mCAAlBA,sBAAe;;;;0BAF5E,MAAmE,CAAnEkB,UAAmE;;;;uCAQzEC,UAAK,EAELjB,aAA8EO;kBAA3DT,eAAQ;iEAARA,eAAQ;MAAEU,WAAW,EAAC,KAAK;MAAChB,KAAK,EAAC;6CAErDC,oBAGM,OAHNyB,UAGM,GAFJlB,aAA6Dc;MAAjDf,OAAK,EAAED,iBAAU;MAAEqB,IAAI,EAAC;;wBAAU,MAAG;;oCACjDnB,aAA6Dc;MAAjDf,OAAK,sCAAED,wBAAiB;;wBAAU,MAAG;;4CAlBxCA,wBAAiB","names":["class","_createElementVNode","style","_hoisted_1","_hoisted_2","_hoisted_3","$setup","onClick","_createVNode","_component_el_icon","_component_edit","_Transition","duration","name","appear","_component_el_input","placeholder","append","_component_el_popover","visible","placement","reference","_component_el_button","disabled","_hoisted_5","_hoisted_6","_hoisted_7","type"],"sourceRoot":"","sources":["F:\\personalSpace\\lx-bishe\\movie_recommendation_system_vue\\src\\components\\personal\\edit\\MailEditing.vue"],"sourcesContent":["<template>\r\n  <div class=\"space mail\">\r\n    <span>绑定邮箱：</span>\r\n    <span style=\"color: rgb(147, 147, 147)\">{{ userMail }}</span>\r\n\r\n    <span @click=\"isShowMailEditing = !isShowMailEditing\" class=\"edit-btn\">\r\n      <el-icon><edit/></el-icon>修改\r\n    </span>\r\n  </div>\r\n\r\n  <transition\r\n      :duration=\"300\"\r\n      name=\"animate__animated animate__zoomOut\"\r\n      appear\r\n      enter-active-class=\"animate__fadeIn\"\r\n      leave-active-class=\"animate__fadeOut \">\r\n    <div v-show=\"isShowMailEditing\">\r\n      <el-input v-model=\"mail\" placeholder=\"请输入新邮箱\" class=\"space input\">\r\n        <template #append>\r\n          <el-popover :visible=\"isInputError\" placement=\"top\" hide-after=\"1000\">\r\n            <p style=\"width: 100%; text-align: center; color: red;\">邮箱格式有误！</p>\r\n            <template #reference>\r\n              <el-button :disabled=\"isDisabled\" @click=\"sendAuthCode\">{{ sendCodeBtnName }}</el-button>\r\n            </template>\r\n          </el-popover>\r\n        </template>\r\n      </el-input>\r\n\r\n      <br/>\r\n\r\n      <el-input v-model=\"authCode\" placeholder=\"验证码\" class=\"space input\"></el-input>\r\n\r\n      <div class=\"space\">\r\n        <el-button @click=\"updateMail\" type=\"primary\">确 定</el-button>\r\n        <el-button @click=\"isShowMailEditing = false\">取 消</el-button>\r\n      </div>\r\n    </div>\r\n  </transition>\r\n</template>\r\n\r\n<script>\r\nimport {ref} from \"vue\";\r\nimport authRequest from \"@/api/authentication\";\r\nimport {ErrorMessage, SuccessMessage} from \"@/utils/my-message\";\r\nimport userRequest from \"@/api/user\";\r\nimport {debounce} from \"@/utils/debounce-throttle\";\r\n\r\nexport default {\r\n  name: \"MailEditing\",\r\n  setup() {\r\n    // 编辑框中邮箱\r\n    let mail = ref(\"\");\r\n    // 用户邮箱\r\n    let userMail = ref(\"未设置\");\r\n    // 验证码\r\n    let authCode = ref(\"\");\r\n    // 是否可以点击“发送验证码”按钮，false表示可以\r\n    let isDisabled = ref(false);\r\n    // “发送验证码”按钮中的信息\r\n    let sendCodeBtnName = ref('发送验证码');\r\n    // 是否显示邮箱编辑\r\n    let isShowMailEditing = ref(false);\r\n    // 邮箱输入是否有误\r\n    let isInputError = ref(false)\r\n    // \\w+表示多个字母数字下划线等，+一个或多个\r\n    const regex = /^\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$/;\r\n\r\n    userRequest.getUserMail().then(res => {\r\n      if (res.code === 200) {\r\n        userMail.value = res.data\r\n        if (!regex.test(userMail.value)) {\r\n          userMail.value = \"未设置\";\r\n        }\r\n      }\r\n    }).catch(err => {\r\n      console.error(err)\r\n    })\r\n\r\n    const sendAuthCode = debounce(() => {\r\n      mail.value = mail.value.trim()\r\n      if (!regex.test(mail.value)) {\r\n        // 邮箱格式有误\r\n        isInputError.value = true;\r\n        const showErr = setInterval(() => {\r\n          isInputError.value = false;\r\n          clearInterval(showErr)\r\n        }, 1000);\r\n        return;\r\n      }\r\n\r\n      authRequest.getAuthCode(mail.value).then(res => {\r\n        if (res.code === 200) {\r\n          SuccessMessage(res.msg);\r\n        }\r\n      }).catch(err => {\r\n        console.error(err)\r\n      })\r\n\r\n      // 60秒内不能再次发送验证码\r\n      sendCodeBtnName.value = \"60秒后可重发\";\r\n      let time = 60;\r\n      isDisabled.value = true;\r\n      const interval = setInterval(() => {\r\n        time--;\r\n        sendCodeBtnName.value = time + \"秒后可重发\";\r\n        // 60秒时间到后，将定时器清除，用户可以重新发送验证码\r\n        if (time === 0) {\r\n          clearInterval(interval)\r\n          sendCodeBtnName.value = '发送验证码';\r\n          isDisabled.value = false;\r\n        }\r\n      }, 1000);\r\n    })\r\n\r\n    const updateMail = () => {\r\n      authCode.value = authCode.value.trim();\r\n      mail.value = mail.value.trim();\r\n      authRequest.updateMail(authCode.value, mail.value).then(res => {\r\n        if (res.code === 200) {\r\n          SuccessMessage(res.msg);\r\n          userMail.value = mail.value;\r\n          mail.value = \"\";\r\n          authCode.value = \"\";\r\n        } else {\r\n          ErrorMessage(res.msg)\r\n        }\r\n        isShowMailEditing.value = false;\r\n      }).catch(err => {\r\n        console.error(err)\r\n      })\r\n    }\r\n\r\n    return {\r\n      mail,\r\n      userMail,\r\n      authCode,\r\n      isDisabled,\r\n      sendCodeBtnName,\r\n      isShowMailEditing,\r\n      isInputError,\r\n      sendAuthCode,\r\n      updateMail,\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.mail {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.space {\r\n  margin: 0.5rem 0;\r\n}\r\n\r\n.input {\r\n  max-width: 400px;\r\n}\r\n\r\n.edit-btn {\r\n  margin-left: 1rem;\r\n  display: flex;\r\n  align-items: center;\r\n  color: rgb(23, 81, 153);\r\n  white-space: nowrap;\r\n  cursor: pointer; // 鼠标放上去显示手势\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}