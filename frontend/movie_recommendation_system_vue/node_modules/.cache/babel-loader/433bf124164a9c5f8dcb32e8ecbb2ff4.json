{"ast":null,"code":"import { ref } from \"vue\";\nimport authRequest from \"@/api/authentication\";\nimport { ErrorMessage, SuccessMessage } from \"@/utils/my-message\";\nimport userRequest from \"@/api/user\";\nimport { debounce } from \"@/utils/debounce-throttle\";\nexport default {\n  name: \"MailEditing\",\n  setup() {\n    // 编辑框中邮箱\n    let mail = ref(\"\");\n    // 用户邮箱\n    let userMail = ref(\"未设置\");\n    // 验证码\n    let authCode = ref(\"\");\n    // 是否可以点击“发送验证码”按钮，false表示可以\n    let isDisabled = ref(false);\n    // “发送验证码”按钮中的信息\n    let sendCodeBtnName = ref('发送验证码');\n    // 是否显示邮箱编辑\n    let isShowMailEditing = ref(false);\n    // 邮箱输入是否有误\n    let isInputError = ref(false);\n    // \\w+表示多个字母数字下划线等，+一个或多个\n    const regex = /^\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$/;\n    userRequest.getUserMail().then(res => {\n      if (res.code === 200) {\n        userMail.value = res.data;\n        if (!regex.test(userMail.value)) {\n          userMail.value = \"未设置\";\n        }\n      }\n    }).catch(err => {\n      console.error(err);\n    });\n    const sendAuthCode = debounce(() => {\n      mail.value = mail.value.trim();\n      if (!regex.test(mail.value)) {\n        // 邮箱格式有误\n        isInputError.value = true;\n        const showErr = setInterval(() => {\n          isInputError.value = false;\n          clearInterval(showErr);\n        }, 1000);\n        return;\n      }\n      authRequest.getAuthCode(mail.value).then(res => {\n        if (res.code === 200) {\n          SuccessMessage(res.msg);\n        }\n      }).catch(err => {\n        console.error(err);\n      });\n\n      // 60秒内不能再次发送验证码\n      sendCodeBtnName.value = \"60秒后可重发\";\n      let time = 60;\n      isDisabled.value = true;\n      const interval = setInterval(() => {\n        time--;\n        sendCodeBtnName.value = time + \"秒后可重发\";\n        // 60秒时间到后，将定时器清除，用户可以重新发送验证码\n        if (time === 0) {\n          clearInterval(interval);\n          sendCodeBtnName.value = '发送验证码';\n          isDisabled.value = false;\n        }\n      }, 1000);\n    });\n    const updateMail = () => {\n      authCode.value = authCode.value.trim();\n      mail.value = mail.value.trim();\n      authRequest.updateMail(authCode.value, mail.value).then(res => {\n        if (res.code === 200) {\n          SuccessMessage(res.msg);\n          userMail.value = mail.value;\n          mail.value = \"\";\n          authCode.value = \"\";\n        } else {\n          ErrorMessage(res.msg);\n        }\n        isShowMailEditing.value = false;\n      }).catch(err => {\n        console.error(err);\n      });\n    };\n    return {\n      mail,\n      userMail,\n      authCode,\n      isDisabled,\n      sendCodeBtnName,\n      isShowMailEditing,\n      isInputError,\n      sendAuthCode,\n      updateMail\n    };\n  }\n};","map":{"version":3,"mappings":"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","names":["ref","authRequest","ErrorMessage","SuccessMessage","userRequest","debounce","name","setup","mail","userMail","authCode","isDisabled","sendCodeBtnName","isShowMailEditing","isInputError","regex","getUserMail","then","res","code","value","data","test","catch","err","console","error","sendAuthCode","trim","showErr","setInterval","clearInterval","getAuthCode","msg","time","interval","updateMail"],"sourceRoot":"","sources":["F:\\personalSpace\\lx-bishe\\movie_recommendation_system_vue\\src\\components\\personal\\edit\\MailEditing.vue"],"sourcesContent":["<template>\r\n  <div class=\"space mail\">\r\n    <span>绑定邮箱：</span>\r\n    <span style=\"color: rgb(147, 147, 147)\">{{ userMail }}</span>\r\n\r\n    <span @click=\"isShowMailEditing = !isShowMailEditing\" class=\"edit-btn\">\r\n      <el-icon><edit/></el-icon>修改\r\n    </span>\r\n  </div>\r\n\r\n  <transition\r\n      :duration=\"300\"\r\n      name=\"animate__animated animate__zoomOut\"\r\n      appear\r\n      enter-active-class=\"animate__fadeIn\"\r\n      leave-active-class=\"animate__fadeOut \">\r\n    <div v-show=\"isShowMailEditing\">\r\n      <el-input v-model=\"mail\" placeholder=\"请输入新邮箱\" class=\"space input\">\r\n        <template #append>\r\n          <el-popover :visible=\"isInputError\" placement=\"top\" hide-after=\"1000\">\r\n            <p style=\"width: 100%; text-align: center; color: red;\">邮箱格式有误！</p>\r\n            <template #reference>\r\n              <el-button :disabled=\"isDisabled\" @click=\"sendAuthCode\">{{ sendCodeBtnName }}</el-button>\r\n            </template>\r\n          </el-popover>\r\n        </template>\r\n      </el-input>\r\n\r\n      <br/>\r\n\r\n      <el-input v-model=\"authCode\" placeholder=\"验证码\" class=\"space input\"></el-input>\r\n\r\n      <div class=\"space\">\r\n        <el-button @click=\"updateMail\" type=\"primary\">确 定</el-button>\r\n        <el-button @click=\"isShowMailEditing = false\">取 消</el-button>\r\n      </div>\r\n    </div>\r\n  </transition>\r\n</template>\r\n\r\n<script>\r\nimport {ref} from \"vue\";\r\nimport authRequest from \"@/api/authentication\";\r\nimport {ErrorMessage, SuccessMessage} from \"@/utils/my-message\";\r\nimport userRequest from \"@/api/user\";\r\nimport {debounce} from \"@/utils/debounce-throttle\";\r\n\r\nexport default {\r\n  name: \"MailEditing\",\r\n  setup() {\r\n    // 编辑框中邮箱\r\n    let mail = ref(\"\");\r\n    // 用户邮箱\r\n    let userMail = ref(\"未设置\");\r\n    // 验证码\r\n    let authCode = ref(\"\");\r\n    // 是否可以点击“发送验证码”按钮，false表示可以\r\n    let isDisabled = ref(false);\r\n    // “发送验证码”按钮中的信息\r\n    let sendCodeBtnName = ref('发送验证码');\r\n    // 是否显示邮箱编辑\r\n    let isShowMailEditing = ref(false);\r\n    // 邮箱输入是否有误\r\n    let isInputError = ref(false)\r\n    // \\w+表示多个字母数字下划线等，+一个或多个\r\n    const regex = /^\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$/;\r\n\r\n    userRequest.getUserMail().then(res => {\r\n      if (res.code === 200) {\r\n        userMail.value = res.data\r\n        if (!regex.test(userMail.value)) {\r\n          userMail.value = \"未设置\";\r\n        }\r\n      }\r\n    }).catch(err => {\r\n      console.error(err)\r\n    })\r\n\r\n    const sendAuthCode = debounce(() => {\r\n      mail.value = mail.value.trim()\r\n      if (!regex.test(mail.value)) {\r\n        // 邮箱格式有误\r\n        isInputError.value = true;\r\n        const showErr = setInterval(() => {\r\n          isInputError.value = false;\r\n          clearInterval(showErr)\r\n        }, 1000);\r\n        return;\r\n      }\r\n\r\n      authRequest.getAuthCode(mail.value).then(res => {\r\n        if (res.code === 200) {\r\n          SuccessMessage(res.msg);\r\n        }\r\n      }).catch(err => {\r\n        console.error(err)\r\n      })\r\n\r\n      // 60秒内不能再次发送验证码\r\n      sendCodeBtnName.value = \"60秒后可重发\";\r\n      let time = 60;\r\n      isDisabled.value = true;\r\n      const interval = setInterval(() => {\r\n        time--;\r\n        sendCodeBtnName.value = time + \"秒后可重发\";\r\n        // 60秒时间到后，将定时器清除，用户可以重新发送验证码\r\n        if (time === 0) {\r\n          clearInterval(interval)\r\n          sendCodeBtnName.value = '发送验证码';\r\n          isDisabled.value = false;\r\n        }\r\n      }, 1000);\r\n    })\r\n\r\n    const updateMail = () => {\r\n      authCode.value = authCode.value.trim();\r\n      mail.value = mail.value.trim();\r\n      authRequest.updateMail(authCode.value, mail.value).then(res => {\r\n        if (res.code === 200) {\r\n          SuccessMessage(res.msg);\r\n          userMail.value = mail.value;\r\n          mail.value = \"\";\r\n          authCode.value = \"\";\r\n        } else {\r\n          ErrorMessage(res.msg)\r\n        }\r\n        isShowMailEditing.value = false;\r\n      }).catch(err => {\r\n        console.error(err)\r\n      })\r\n    }\r\n\r\n    return {\r\n      mail,\r\n      userMail,\r\n      authCode,\r\n      isDisabled,\r\n      sendCodeBtnName,\r\n      isShowMailEditing,\r\n      isInputError,\r\n      sendAuthCode,\r\n      updateMail,\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.mail {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.space {\r\n  margin: 0.5rem 0;\r\n}\r\n\r\n.input {\r\n  max-width: 400px;\r\n}\r\n\r\n.edit-btn {\r\n  margin-left: 1rem;\r\n  display: flex;\r\n  align-items: center;\r\n  color: rgb(23, 81, 153);\r\n  white-space: nowrap;\r\n  cursor: pointer; // 鼠标放上去显示手势\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}