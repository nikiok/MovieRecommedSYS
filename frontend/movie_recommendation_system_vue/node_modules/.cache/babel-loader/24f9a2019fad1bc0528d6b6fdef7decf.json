{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, normalizeStyle as _normalizeStyle, withCtx as _withCtx, createElementVNode as _createElementVNode, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-6af51c69\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"edit-img\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_UserFilled = _resolveComponent(\"UserFilled\");\n  const _component_el_avatar = _resolveComponent(\"el-avatar\");\n  const _component_svg_icon = _resolveComponent(\"svg-icon\");\n  const _component_my_upload = _resolveComponent(\"my-upload\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createElementVNode(\"div\", {\n    onClick: _cache[0] || (_cache[0] = (...args) => $setup.toggleShow && $setup.toggleShow(...args)),\n    class: \"avatar-edit-master\"\n  }, [_createVNode(_component_el_avatar, {\n    class: \"avatar\",\n    shape: \"square\",\n    style: _normalizeStyle(`width: ${$props.size}rem; height: ${$props.size}rem;`),\n    src: _ctx.imgDataUrl,\n    alt: \"头像\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_UserFilled, {\n      class: \"inner\"\n    })]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"style\", \"src\"]), _createElementVNode(\"div\", _hoisted_1, [_createVNode(_component_svg_icon, {\n    \"icon-class\": \"avatar_edit\",\n    style: {\n      \"width\": \"5rem\",\n      \"height\": \"5rem\"\n    }\n  })])]), _createVNode(_component_my_upload, {\n    field: \"img\",\n    onCropSuccess: $setup.cropSuccess,\n    modelValue: _ctx.show,\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => _ctx.show = $event),\n    width: 200,\n    height: 200,\n    \"no-rotate\": false,\n    \"img-format\": \"png\"\n  }, null, 8 /* PROPS */, [\"onCropSuccess\", \"modelValue\"])], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"mappings":";;;EAOSA,KAAK,EAAC;AAAU;;;;;;6DANvBC,oBASM;IATAC,OAAK,yCAAEC,+CAAU;IAAEH,KAAK,EAAC;MAC7BI,aAGYC;IAHDL,KAAK,EAAC,QAAQ;IAACM,KAAK,EAAC,QAAQ;IAAEC,KAAK,4BAAYC,WAAI,gBAAgBA,WAAI;IAASC,GAAG,EAAEC,eAAU;IAChGC,GAAG,EAAC;;sBACb,MAAuC,CAAvCP,aAAuCQ;MAA3BZ,KAAK,EAAC;IAAO;;uCAG3BC,oBAEM,OAFNY,UAEM,GADJT,aAAiFU;IAAvE,YAAU,EAAC,aAAa;IAACP,KAAkC,EAAlC;MAAA;MAAA;IAAA;UAIvCH,aAOYW;IAPDC,KAAK,EAAC,KAAK;IACVC,aAAY,EAAEd,kBAAW;gBACjBO,SAAI;+DAAJA,SAAI;IACZQ,KAAK,EAAE,GAAG;IACVC,MAAM,EAAE,GAAG;IACX,WAAS,EAAE,KAAK;IACjB,YAAU,EAAC","names":["class","_createElementVNode","onClick","$setup","_createVNode","_component_el_avatar","shape","style","$props","src","_ctx","alt","_component_UserFilled","_hoisted_1","_component_svg_icon","_component_my_upload","field","onCropSuccess","width","height"],"sourceRoot":"","sources":["F:\\personalSpace\\lx-bishe\\movie_recommendation_system_vue\\src\\components\\personal\\edit\\AvatarEditing.vue"],"sourcesContent":["<template>\r\n  <div @click=\"toggleShow\" class=\"avatar-edit-master\">\r\n    <el-avatar class=\"avatar\" shape=\"square\" :style=\"`width: ${size}rem; height: ${size}rem;`\" :src=\"imgDataUrl\"\r\n               alt=\"头像\">\r\n      <UserFilled class=\"inner\"></UserFilled>\r\n    </el-avatar>\r\n\r\n    <div class=\"edit-img\">\r\n      <svg-icon icon-class=\"avatar_edit\" style=\"width: 5rem; height: 5rem;\"></svg-icon>\r\n    </div>\r\n  </div>\r\n\r\n  <my-upload field=\"img\"\r\n             @crop-success=\"cropSuccess\"\r\n             v-model=\"show\"\r\n             :width=\"200\"\r\n             :height=\"200\"\r\n             :no-rotate=\"false\"\r\n             img-format=\"png\">\r\n  </my-upload>\r\n</template>\r\n\r\n<script>\r\nimport MyUpload from 'vue-image-crop-upload';\r\nimport {UserFilled} from '@element-plus/icons-vue'\r\nimport {onBeforeUnmount, reactive, toRefs} from \"vue\";\r\nimport request from \"@/utils/request\";\r\nimport emitter from \"@/utils/event-bus\";\r\nimport {ErrorMessage, SuccessMessage} from \"@/utils/my-message\";\r\nimport {Edit} from \"@element-plus/icons\";\r\nimport SvgIcon from \"@/components/basic/SvgIcon\";\r\n\r\nexport default {\r\n  name: 'AvatarEdit',\r\n  components: {SvgIcon, Edit, MyUpload, UserFilled},\r\n  props: {\r\n    size: {\r\n      type: Number,\r\n      default: 15,\r\n    },\r\n    avatar: {\r\n      type: String,\r\n      default: '',\r\n    }\r\n  },\r\n  setup() {\r\n    let data = reactive({\r\n      show: false,\r\n      field: {\r\n        avatar: ''\r\n      },\r\n      params: {},\r\n      headers: {\r\n        'token': localStorage.getItem('token'),\r\n        'Content-Type': 'application/json; charset=utf-8'\r\n      },\r\n      imgDataUrl: ''\r\n    })\r\n\r\n    let toggleShow = function toggleShow() {\r\n      data.show = !data.show;\r\n    }\r\n\r\n    /**\r\n     * 图片截取完成事件\r\n     *\r\n     * [param] imgDataUrl\r\n     * [param] field\r\n     */\r\n    let cropSuccess = function cropSuccess(imgDataUrl, field) {\r\n      console.log('-------- crop success --------');\r\n      data.imgDataUrl = imgDataUrl\r\n      data.field.avatar = imgDataUrl\r\n\r\n      // 图片截取完成后，将图片信息上传到服务器\r\n      request({\r\n        url: '/user/update/avatar',\r\n        method: 'post',\r\n        headers: {\r\n          isNeedToken: true,\r\n        },\r\n        data: imgDataUrl\r\n      }).then(res => {\r\n        if (res.code === 200) {\r\n          SuccessMessage(res.msg)\r\n\r\n          emitter.emit('handleHeaderAvatarChange', {\r\n            avatar: data.imgDataUrl\r\n          })\r\n        } else {\r\n          ErrorMessage(res.msg)\r\n        }\r\n      }).catch(err => {\r\n        console.error(err)\r\n      })\r\n    }\r\n\r\n    /**\r\n     * 全局事件总线——监听\r\n     * 事件触发时，替换头像路径\r\n     */\r\n    emitter.on('handleEditAvatarChange', res => {\r\n      data.imgDataUrl = res.avatar\r\n    })\r\n\r\n    onBeforeUnmount(() => {\r\n      emitter.off('handleEditAvatarChange')\r\n    })\r\n\r\n    return {\r\n      ...toRefs(data),\r\n      toggleShow,\r\n      cropSuccess,\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.avatar-edit-master {\r\n  position: relative;\r\n  text-align: center;\r\n\r\n  .avatar {\r\n    margin-top: 5px;\r\n    margin-bottom: 5px;\r\n  }\r\n\r\n  .edit-img {\r\n    display: none;\r\n    z-index: 100;\r\n    position: absolute;\r\n    left: 3.55rem;\r\n    top: 3.55rem;\r\n\r\n    img {\r\n      width: 5rem;\r\n    }\r\n  }\r\n}\r\n\r\n.avatar-edit-master:hover {\r\n  filter: brightness(70%);\r\n\r\n  .edit-img {\r\n    display: block;\r\n  }\r\n}\r\n\r\n.avatar .inner {\r\n  width: 100px;\r\n  height: 100px;\r\n}\r\n\r\n@media screen and (max-width: 657px) {\r\n  /deep/ .vicp-wrap {\r\n    width: 290px;\r\n  }\r\n\r\n  /deep/ .vicp-operate {\r\n    position: absolute;\r\n    left: 25px;\r\n    bottom: 20px;\r\n  }\r\n\r\n  /deep/ .vicp-preview-item {\r\n    display: none;\r\n  }\r\n}\r\n\r\n</style>"]},"metadata":{},"sourceType":"module"}