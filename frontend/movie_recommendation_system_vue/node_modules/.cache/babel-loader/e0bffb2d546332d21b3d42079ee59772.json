{"ast":null,"code":"import { createElementVNode as _createElementVNode, vShow as _vShow, withDirectives as _withDirectives, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createTextVNode as _createTextVNode, normalizeStyle as _normalizeStyle, withModifiers as _withModifiers, vModelText as _vModelText } from \"vue\";\nconst _hoisted_1 = {\n  class: \"vue-image-crop-upload\"\n};\nconst _hoisted_2 = {\n  class: \"vicp-wrap\"\n};\nconst _hoisted_3 = /*#__PURE__*/_createElementVNode(\"i\", {\n  class: \"vicp-icon4\"\n}, null, -1 /* HOISTED */);\nconst _hoisted_4 = [_hoisted_3];\nconst _hoisted_5 = {\n  class: \"vicp-step1\"\n};\nconst _hoisted_6 = {\n  class: \"vicp-icon1\"\n};\nconst _hoisted_7 = /*#__PURE__*/_createElementVNode(\"i\", {\n  class: \"vicp-icon1-arrow\"\n}, null, -1 /* HOISTED */);\nconst _hoisted_8 = /*#__PURE__*/_createElementVNode(\"i\", {\n  class: \"vicp-icon1-body\"\n}, null, -1 /* HOISTED */);\nconst _hoisted_9 = /*#__PURE__*/_createElementVNode(\"i\", {\n  class: \"vicp-icon1-bottom\"\n}, null, -1 /* HOISTED */);\nconst _hoisted_10 = [_hoisted_7, _hoisted_8, _hoisted_9];\nconst _hoisted_11 = {\n  class: \"vicp-error\"\n};\nconst _hoisted_12 = /*#__PURE__*/_createElementVNode(\"i\", {\n  class: \"vicp-icon2\"\n}, null, -1 /* HOISTED */);\nconst _hoisted_13 = {\n  class: \"vicp-operate\"\n};\nconst _hoisted_14 = {\n  key: 0,\n  class: \"vicp-step2\"\n};\nconst _hoisted_15 = {\n  class: \"vicp-crop\"\n};\nconst _hoisted_16 = {\n  class: \"vicp-crop-left\"\n};\nconst _hoisted_17 = [\"src\"];\nconst _hoisted_18 = {\n  class: \"vicp-range\"\n};\nconst _hoisted_19 = {\n  key: 0,\n  class: \"vicp-rotate\"\n};\nconst _hoisted_20 = {\n  class: \"vicp-crop-right\"\n};\nconst _hoisted_21 = {\n  class: \"vicp-preview\"\n};\nconst _hoisted_22 = {\n  key: 0,\n  class: \"vicp-preview-item\"\n};\nconst _hoisted_23 = [\"src\"];\nconst _hoisted_24 = {\n  key: 1,\n  class: \"vicp-preview-item vicp-preview-item-circle\"\n};\nconst _hoisted_25 = [\"src\"];\nconst _hoisted_26 = {\n  class: \"vicp-operate\"\n};\nconst _hoisted_27 = {\n  key: 1,\n  class: \"vicp-step3\"\n};\nconst _hoisted_28 = {\n  class: \"vicp-upload\"\n};\nconst _hoisted_29 = {\n  class: \"vicp-progress-wrap\"\n};\nconst _hoisted_30 = {\n  class: \"vicp-error\"\n};\nconst _hoisted_31 = /*#__PURE__*/_createElementVNode(\"i\", {\n  class: \"vicp-icon2\"\n}, null, -1 /* HOISTED */);\nconst _hoisted_32 = {\n  class: \"vicp-success\"\n};\nconst _hoisted_33 = /*#__PURE__*/_createElementVNode(\"i\", {\n  class: \"vicp-icon3\"\n}, null, -1 /* HOISTED */);\nconst _hoisted_34 = {\n  class: \"vicp-operate\"\n};\nconst _hoisted_35 = [\"width\", \"height\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _withDirectives((_openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", {\n    class: \"vicp-close\",\n    onClick: _cache[0] || (_cache[0] = (...args) => $options.off && $options.off(...args))\n  }, _hoisted_4), _withDirectives(_createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"div\", {\n    class: \"vicp-drop-area\",\n    onDragleave: _cache[2] || (_cache[2] = (...args) => $options.preventDefault && $options.preventDefault(...args)),\n    onDragover: _cache[3] || (_cache[3] = (...args) => $options.preventDefault && $options.preventDefault(...args)),\n    onDragenter: _cache[4] || (_cache[4] = (...args) => $options.preventDefault && $options.preventDefault(...args)),\n    onClick: _cache[5] || (_cache[5] = (...args) => $options.handleClick && $options.handleClick(...args)),\n    onDrop: _cache[6] || (_cache[6] = (...args) => $options.handleChange && $options.handleChange(...args))\n  }, [_withDirectives(_createElementVNode(\"i\", _hoisted_6, _hoisted_10, 512 /* NEED_PATCH */), [[_vShow, $data.loading != 1]]), _withDirectives(_createElementVNode(\"span\", {\n    class: \"vicp-hint\"\n  }, _toDisplayString($data.lang.hint), 513 /* TEXT, NEED_PATCH */), [[_vShow, $data.loading !== 1]]), _withDirectives(_createElementVNode(\"span\", {\n    class: \"vicp-no-supported-hint\"\n  }, _toDisplayString($data.lang.noSupported), 513 /* TEXT, NEED_PATCH */), [[_vShow, !$data.isSupported]]), $data.step == 1 ? _withDirectives((_openBlock(), _createElementBlock(\"input\", {\n    key: 0,\n    type: \"file\",\n    accept: \"image/*\",\n    onChange: _cache[1] || (_cache[1] = (...args) => $options.handleChange && $options.handleChange(...args)),\n    ref: \"fileinput\"\n  }, null, 544 /* HYDRATE_EVENTS, NEED_PATCH */)), [[_vShow, false]]) : _createCommentVNode(\"v-if\", true)], 32 /* HYDRATE_EVENTS */), _withDirectives(_createElementVNode(\"div\", _hoisted_11, [_hoisted_12, _createTextVNode(\" \" + _toDisplayString($data.errorMsg), 1 /* TEXT */)], 512 /* NEED_PATCH */), [[_vShow, $data.hasError]]), _createElementVNode(\"div\", _hoisted_13, [_createElementVNode(\"a\", {\n    onClick: _cache[7] || (_cache[7] = (...args) => $options.off && $options.off(...args)),\n    onMousedown: _cache[8] || (_cache[8] = (...args) => $options.ripple && $options.ripple(...args))\n  }, _toDisplayString($data.lang.btn.off), 33 /* TEXT, HYDRATE_EVENTS */)])], 512 /* NEED_PATCH */), [[_vShow, $data.step == 1]]), $data.step == 2 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_14, [_createElementVNode(\"div\", _hoisted_15, [_withDirectives(_createElementVNode(\"div\", _hoisted_16, [_createElementVNode(\"div\", {\n    class: \"vicp-img-container\",\n    onWheel: _cache[24] || (_cache[24] = _withModifiers((...args) => $options.handleMouseWheel && $options.handleMouseWheel(...args), [\"prevent\"]))\n  }, [_createElementVNode(\"img\", {\n    src: $data.sourceImgUrl,\n    style: _normalizeStyle($options.sourceImgStyle),\n    class: \"vicp-img\",\n    draggable: \"false\",\n    onDrag: _cache[9] || (_cache[9] = (...args) => $options.preventDefault && $options.preventDefault(...args)),\n    onDragstart: _cache[10] || (_cache[10] = (...args) => $options.preventDefault && $options.preventDefault(...args)),\n    onDragend: _cache[11] || (_cache[11] = (...args) => $options.preventDefault && $options.preventDefault(...args)),\n    onDragleave: _cache[12] || (_cache[12] = (...args) => $options.preventDefault && $options.preventDefault(...args)),\n    onDragover: _cache[13] || (_cache[13] = (...args) => $options.preventDefault && $options.preventDefault(...args)),\n    onDragenter: _cache[14] || (_cache[14] = (...args) => $options.preventDefault && $options.preventDefault(...args)),\n    onDrop: _cache[15] || (_cache[15] = (...args) => $options.preventDefault && $options.preventDefault(...args)),\n    onTouchstart: _cache[16] || (_cache[16] = (...args) => $options.imgStartMove && $options.imgStartMove(...args)),\n    onTouchmove: _cache[17] || (_cache[17] = (...args) => $options.imgMove && $options.imgMove(...args)),\n    onTouchend: _cache[18] || (_cache[18] = (...args) => $options.createImg && $options.createImg(...args)),\n    onTouchcancel: _cache[19] || (_cache[19] = (...args) => $options.createImg && $options.createImg(...args)),\n    onMousedown: _cache[20] || (_cache[20] = (...args) => $options.imgStartMove && $options.imgStartMove(...args)),\n    onMousemove: _cache[21] || (_cache[21] = (...args) => $options.imgMove && $options.imgMove(...args)),\n    onMouseup: _cache[22] || (_cache[22] = (...args) => $options.createImg && $options.createImg(...args)),\n    onMouseout: _cache[23] || (_cache[23] = (...args) => $options.createImg && $options.createImg(...args)),\n    ref: \"img\"\n  }, null, 44 /* STYLE, PROPS, HYDRATE_EVENTS */, _hoisted_17), _createElementVNode(\"div\", {\n    class: \"vicp-img-shade vicp-img-shade-1\",\n    style: _normalizeStyle($options.sourceImgShadeStyle)\n  }, null, 4 /* STYLE */), _createElementVNode(\"div\", {\n    class: \"vicp-img-shade vicp-img-shade-2\",\n    style: _normalizeStyle($options.sourceImgShadeStyle)\n  }, null, 4 /* STYLE */)], 32 /* HYDRATE_EVENTS */), _createElementVNode(\"div\", _hoisted_18, [_withDirectives(_createElementVNode(\"input\", {\n    type: \"range\",\n    \"onUpdate:modelValue\": _cache[25] || (_cache[25] = $event => $data.scale.range = $event),\n    step: \"1\",\n    min: \"0\",\n    max: \"100\",\n    onMousemove: _cache[26] || (_cache[26] = (...args) => $options.zoomChange && $options.zoomChange(...args))\n  }, null, 544 /* HYDRATE_EVENTS, NEED_PATCH */), [[_vModelText, $data.scale.range]]), _createElementVNode(\"i\", {\n    onMousedown: _cache[27] || (_cache[27] = (...args) => $options.startZoomSub && $options.startZoomSub(...args)),\n    onMouseout: _cache[28] || (_cache[28] = (...args) => $options.endZoomSub && $options.endZoomSub(...args)),\n    onMouseup: _cache[29] || (_cache[29] = (...args) => $options.endZoomSub && $options.endZoomSub(...args)),\n    class: \"vicp-icon5\"\n  }, null, 32 /* HYDRATE_EVENTS */), _createElementVNode(\"i\", {\n    onMousedown: _cache[30] || (_cache[30] = (...args) => $options.startZoomAdd && $options.startZoomAdd(...args)),\n    onMouseout: _cache[31] || (_cache[31] = (...args) => $options.endZoomAdd && $options.endZoomAdd(...args)),\n    onMouseup: _cache[32] || (_cache[32] = (...args) => $options.endZoomAdd && $options.endZoomAdd(...args)),\n    class: \"vicp-icon6\"\n  }, null, 32 /* HYDRATE_EVENTS */)]), !$props.noRotate ? (_openBlock(), _createElementBlock(\"div\", _hoisted_19, [_createElementVNode(\"i\", {\n    onClick: _cache[33] || (_cache[33] = (...args) => $options.rotateImg && $options.rotateImg(...args))\n  }, \"↻\")])) : _createCommentVNode(\"v-if\", true)], 512 /* NEED_PATCH */), [[_vShow, true]]), _withDirectives(_createElementVNode(\"div\", _hoisted_20, [_createElementVNode(\"div\", _hoisted_21, [!$props.noSquare ? (_openBlock(), _createElementBlock(\"div\", _hoisted_22, [_createElementVNode(\"img\", {\n    src: $data.createImgUrl,\n    style: _normalizeStyle($options.previewStyle)\n  }, null, 12 /* STYLE, PROPS */, _hoisted_23), _createElementVNode(\"span\", null, _toDisplayString($data.lang.preview), 1 /* TEXT */)])) : _createCommentVNode(\"v-if\", true), !$props.noCircle ? (_openBlock(), _createElementBlock(\"div\", _hoisted_24, [_createElementVNode(\"img\", {\n    src: $data.createImgUrl,\n    style: _normalizeStyle($options.previewStyle)\n  }, null, 12 /* STYLE, PROPS */, _hoisted_25), _createElementVNode(\"span\", null, _toDisplayString($data.lang.preview), 1 /* TEXT */)])) : _createCommentVNode(\"v-if\", true)])], 512 /* NEED_PATCH */), [[_vShow, true]])]), _createElementVNode(\"div\", _hoisted_26, [_createElementVNode(\"a\", {\n    onClick: _cache[34] || (_cache[34] = $event => $options.setStep(1)),\n    onMousedown: _cache[35] || (_cache[35] = (...args) => $options.ripple && $options.ripple(...args))\n  }, _toDisplayString($data.lang.btn.back), 33 /* TEXT, HYDRATE_EVENTS */), _createElementVNode(\"a\", {\n    class: \"vicp-operate-btn\",\n    onClick: _cache[36] || (_cache[36] = (...args) => $options.prepareUpload && $options.prepareUpload(...args)),\n    onMousedown: _cache[37] || (_cache[37] = (...args) => $options.ripple && $options.ripple(...args))\n  }, _toDisplayString($data.lang.btn.save), 33 /* TEXT, HYDRATE_EVENTS */)])])) : _createCommentVNode(\"v-if\", true), $data.step == 3 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_27, [_createElementVNode(\"div\", _hoisted_28, [_withDirectives(_createElementVNode(\"span\", {\n    class: \"vicp-loading\"\n  }, _toDisplayString($data.lang.loading), 513 /* TEXT, NEED_PATCH */), [[_vShow, $data.loading === 1]]), _createElementVNode(\"div\", _hoisted_29, [_withDirectives(_createElementVNode(\"span\", {\n    class: \"vicp-progress\",\n    style: _normalizeStyle($options.progressStyle)\n  }, null, 4 /* STYLE */), [[_vShow, $data.loading === 1]])]), _withDirectives(_createElementVNode(\"div\", _hoisted_30, [_hoisted_31, _createTextVNode(\" \" + _toDisplayString($data.errorMsg), 1 /* TEXT */)], 512 /* NEED_PATCH */), [[_vShow, $data.hasError]]), _withDirectives(_createElementVNode(\"div\", _hoisted_32, [_hoisted_33, _createTextVNode(\" \" + _toDisplayString($data.lang.success), 1 /* TEXT */)], 512 /* NEED_PATCH */), [[_vShow, $data.loading === 2]])]), _createElementVNode(\"div\", _hoisted_34, [_createElementVNode(\"a\", {\n    onClick: _cache[38] || (_cache[38] = $event => $options.setStep(2)),\n    onMousedown: _cache[39] || (_cache[39] = (...args) => $options.ripple && $options.ripple(...args))\n  }, _toDisplayString($data.lang.btn.back), 33 /* TEXT, HYDRATE_EVENTS */), _createElementVNode(\"a\", {\n    onClick: _cache[40] || (_cache[40] = (...args) => $options.off && $options.off(...args)),\n    onMousedown: _cache[41] || (_cache[41] = (...args) => $options.ripple && $options.ripple(...args))\n  }, _toDisplayString($data.lang.btn.close), 33 /* TEXT, HYDRATE_EVENTS */)])])) : _createCommentVNode(\"v-if\", true), _withDirectives(_createElementVNode(\"canvas\", {\n    width: $props.width,\n    height: $props.height,\n    ref: \"canvas\"\n  }, null, 8 /* PROPS */, _hoisted_35), [[_vShow, false]])])], 512 /* NEED_PATCH */)), [[_vShow, $props.modelValue]]);\n}","map":{"version":3,"mappings":"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","names":["class","_createElementVNode","_hoisted_3","_hoisted_7","_hoisted_8","_hoisted_9","_createElementBlock","_hoisted_1","_hoisted_2","onClick","$options","_hoisted_5","onDragleave","onDragover","onDragenter","onDrop","_hoisted_6","$data","hint","noSupported","type","accept","onChange","ref","_hoisted_11","_hoisted_12","_hoisted_13","onMousedown","btn","off","_hoisted_14","_hoisted_15","_hoisted_16","onWheel","src","style","draggable","onDrag","onDragstart","onDragend","onTouchstart","onTouchmove","onTouchend","onTouchcancel","onMousemove","onMouseup","onMouseout","_hoisted_18","range","step","min","max","$props","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","preview","_hoisted_24","_hoisted_26","back","save","_hoisted_27","_hoisted_28","loading","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","success","_hoisted_34","close","width","height"],"sourceRoot":"","sources":["F:\\personalSpace\\lx-bishe\\movie_recommendation_system_vue\\node_modules\\vue-image-crop-upload\\upload-3.vue"],"sourcesContent":["<template>\n<div class=\"vue-image-crop-upload\" v-show=\"modelValue\">\n\t<div class=\"vicp-wrap\">\n\t\t<div class=\"vicp-close\" @click=\"off\">\n\t\t\t<i class=\"vicp-icon4\"></i>\n\t\t</div>\n\n\t\t<div class=\"vicp-step1\" v-show=\"step == 1\">\n\t\t\t<div class=\"vicp-drop-area\" @dragleave=\"preventDefault\" @dragover=\"preventDefault\" @dragenter=\"preventDefault\" @click=\"handleClick\" @drop=\"handleChange\">\n\t\t\t\t<i class=\"vicp-icon1\" v-show=\"loading != 1\">\n\t\t\t\t<i class=\"vicp-icon1-arrow\"></i>\n\t\t\t\t<i class=\"vicp-icon1-body\"></i>\n\t\t\t\t<i class=\"vicp-icon1-bottom\"></i>\n\t\t\t\t</i>\n\t\t\t\t<span class=\"vicp-hint\" v-show=\"loading !== 1\">{{ lang.hint }}</span>\n\t\t\t\t<span class=\"vicp-no-supported-hint\" v-show=\"!isSupported\">{{ lang.noSupported }}</span>\n\t\t\t\t<input type=\"file\" accept=\"image/*\" v-show=\"false\" v-if=\"step == 1\" @change=\"handleChange\" ref=\"fileinput\">\n\t\t\t</div>\n\t\t\t<div class=\"vicp-error\" v-show=\"hasError\">\n\t\t\t\t<i class=\"vicp-icon2\"></i> {{ errorMsg }}\n\t\t\t</div>\n\t\t\t<div class=\"vicp-operate\">\n\t\t\t\t<a @click=\"off\" @mousedown=\"ripple\">{{ lang.btn.off }}</a>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"vicp-step2\" v-if=\"step == 2\">\n\t\t\t<div class=\"vicp-crop\">\n\t\t\t\t<div class=\"vicp-crop-left\" v-show=\"true\">\n\t\t\t\t\t<div class=\"vicp-img-container\" @wheel.prevent=\"handleMouseWheel\">\n\t\t\t\t\t\t<img :src=\"sourceImgUrl\" :style=\"sourceImgStyle\" class=\"vicp-img\" draggable=\"false\"\n\t\t\t\t\t\t\t@drag=\"preventDefault\"\n\t\t\t\t\t\t\t@dragstart=\"preventDefault\"\n\t\t\t\t\t\t\t@dragend=\"preventDefault\"\n\t\t\t\t\t\t\t@dragleave=\"preventDefault\"\n\t\t\t\t\t\t\t@dragover=\"preventDefault\"\n\t\t\t\t\t\t\t@dragenter=\"preventDefault\"\n\t\t\t\t\t\t\t@drop=\"preventDefault\"\n\t\t\t\t\t\t\t@touchstart=\"imgStartMove\"\n\t\t\t\t\t\t\t@touchmove=\"imgMove\"\n\t\t\t\t\t\t\t@touchend=\"createImg\"\n\t\t\t\t\t\t\t@touchcancel=\"createImg\"\n\t\t\t\t\t\t\t@mousedown=\"imgStartMove\"\n\t\t\t\t\t\t\t@mousemove=\"imgMove\"\n\t\t\t\t\t\t\t@mouseup=\"createImg\"\n\t\t\t\t\t\t\t@mouseout=\"createImg\"\n\t\t\t\t\t\t\tref=\"img\">\n\t\t\t\t\t\t<div class=\"vicp-img-shade vicp-img-shade-1\" :style=\"sourceImgShadeStyle\"></div>\n\t\t\t\t\t\t<div class=\"vicp-img-shade vicp-img-shade-2\" :style=\"sourceImgShadeStyle\"></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"vicp-range\">\n\t\t\t\t\t\t<input type=\"range\" v-model=\"scale.range\" step=\"1\" min=\"0\" max=\"100\" @mousemove=\"zoomChange\">\n\t\t\t\t\t\t<i @mousedown=\"startZoomSub\" @mouseout=\"endZoomSub\" @mouseup=\"endZoomSub\" class=\"vicp-icon5\"></i>\n\t\t\t\t\t\t<i @mousedown=\"startZoomAdd\" @mouseout=\"endZoomAdd\" @mouseup=\"endZoomAdd\" class=\"vicp-icon6\"></i>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"vicp-rotate\" v-if=\"!noRotate\">\n                        <i @click=\"rotateImg\">↻</i>\n                    </div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"vicp-crop-right\" v-show=\"true\">\n\t\t\t\t\t<div class=\"vicp-preview\">\n\t\t\t\t\t\t<div class=\"vicp-preview-item\" v-if=\"!noSquare\">\n\t\t\t\t\t\t\t<img :src=\"createImgUrl\" :style=\"previewStyle\">\n\t\t\t\t\t\t\t<span>{{ lang.preview }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"vicp-preview-item vicp-preview-item-circle\" v-if=\"!noCircle\">\n\t\t\t\t\t\t\t<img :src=\"createImgUrl\" :style=\"previewStyle\">\n\t\t\t\t\t\t\t<span>{{ lang.preview }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"vicp-operate\">\n\t\t\t\t<a @click=\"setStep(1)\" @mousedown=\"ripple\">{{ lang.btn.back }}</a>\n\t\t\t\t<a class=\"vicp-operate-btn\" @click=\"prepareUpload\" @mousedown=\"ripple\">{{ lang.btn.save }}</a>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"vicp-step3\" v-if=\"step == 3\">\n\t\t\t<div class=\"vicp-upload\">\n\t\t\t\t<span class=\"vicp-loading\" v-show=\"loading === 1\">{{ lang.loading }}</span>\n\t\t\t\t<div class=\"vicp-progress-wrap\">\n\t\t\t\t\t<span class=\"vicp-progress\" v-show=\"loading === 1\" :style=\"progressStyle\"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"vicp-error\" v-show=\"hasError\">\n\t\t\t\t\t<i class=\"vicp-icon2\"></i> {{ errorMsg }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"vicp-success\" v-show=\"loading === 2\">\n\t\t\t\t\t<i class=\"vicp-icon3\"></i> {{ lang.success }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"vicp-operate\">\n\t\t\t\t<a @click=\"setStep(2)\" @mousedown=\"ripple\">{{ lang.btn.back }}</a>\n\t\t\t\t<a @click=\"off\" @mousedown=\"ripple\">{{ lang.btn.close }}</a>\n\t\t\t</div>\n\t\t</div>\n\t\t<canvas v-show=\"false\" :width=\"width\" :height=\"height\" ref=\"canvas\"></canvas>\n\t</div>\n</div>\n</template>\n\n<script>\n'use strict';\nimport language from './utils/language.js';\nimport mimes from './utils/mimes.js';\nimport data2blob from './utils/data2blob.js';\nimport effectRipple from './utils/effectRipple.js';\n\nexport default {\n\tprops: {\n\t\t// 域，上传文件name，触发事件会带上（如果一个页面多个图片上传控件，可以做区分\n\t\tfield: {\n\t\t\ttype: String,\n\t\t\t'default': 'avatar'\n\t\t},\n\t\t// 原名key，类似于id，触发事件会带上（如果一个页面多个图片上传控件，可以做区分\n\t\tki: {\n\t\t\ttype: String,\n\t\t\t'default': '0'\n\t\t},\n\t\t// 显示该控件与否\n\t\tmodelValue: {\n\t\t\ttype: Boolean,\n\t\t\t'default': true\n\t\t},\n\t\t// 上传地址\n\t\turl: {\n\t\t\ttype: String,\n\t\t\t'default': ''\n\t\t},\n\t\t// 其他要上传文件附带的数据，对象格式\n\t\tparams: {\n\t\t\ttype: Object,\n\t\t\t'default': ()=>null\n\t\t},\n\t\t//Add custom headers\n\t\theaders: {\n\t\t\ttype: Object,\n\t\t\t'default': ()=>null\n\t\t},\n\t\t// 剪裁图片的宽\n\t\twidth: {\n\t\t\ttype: Number,\n\t\t\tdefault: 200\n\t\t},\n\t\t// 剪裁图片的高\n\t\theight: {\n\t\t\ttype: Number,\n\t\t\tdefault: 200\n\t\t},\n\t\t// 不显示旋转功能\n\t\tnoRotate: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\t\t// 不预览圆形图片\n\t\tnoCircle: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\t\t// 不预览方形图片\n\t\tnoSquare: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\t\t// 单文件大小限制\n\t\tmaxSize: {\n\t\t\ttype: Number,\n\t\t\t'default': 10240\n\t\t},\n\t\t// 语言类型\n\t\tlangType: {\n\t\t\ttype: String,\n\t\t\t'default': 'zh'\n\t\t},\n\t\t// 语言包\n\t\tlangExt: {\n\t\t\ttype: Object,\n\t\t\t'default': ()=>null\n\t\t},\n\t\t// 图片上传格式\n\t\timgFormat: {\n\t\t\ttype: String,\n\t\t\t'default': 'png'\n\t\t},\n\t\t// 图片背景 jpg情况下生效\n\t\timgBgc: {\n\t\t\ttype: String,\n\t\t\t'default': '#fff'\n\t\t},\n\t\t// 是否支持跨域\n\t\twithCredentials: {\n\t\t\ttype: Boolean,\n\t\t\t'default': false\n\t\t},\n\t\tmethod: {\n\t\t\ttype: String,\n\t\t\t'default': 'POST'\n\t\t},\n\t\tinitialImgUrl: {\n\t\t\ttype: String,\n\t\t\t'default': ''\n\t    },\n\t    allowImgFormat: {\n\t    \ttype: Array,\n\t    \t'default': ()=>[\n\t\t    \t'gif',\n\t\t\t'jpg',\n\t\t\t'png'\n\t\t\t]\n\t    }\n\t},\n\n\tdata() {\n\t\tlet that = this,\n\t\t\t{\n\t\t\t\timgFormat,\n\t\t\t\tallowImgFormat,\n\t\t\t\tlangType,\n\t\t\t\tlangExt,\n\t\t\t\twidth,\n\t\t\t\theight\n\t\t\t} = that,\n\t\t\tisSupported = true,\n\t\t\ttempImgFormat = allowImgFormat.indexOf(imgFormat) === -1 ? 'jpg' : imgFormat,\n\t\t\tlang = language[langType] ? language[langType] : language['en'],\n\t\t\tmime = mimes[tempImgFormat];\n\t\t// 规范图片格式\n\t\t// that.imgFormat = tempImgFormat;\n\n\t\tif (langExt) {\n\t\t\tObject.assign(lang, langExt);\n\t\t}\n\t\tif (typeof FormData != 'function') {\n\t\t\tisSupported = false;\n\t\t}\n\t\treturn {\n\t\t\t// 图片的mime\n\t\t\tmime,\n\n\t\t\t// 语言包\n\t\t\tlang,\n\n\t\t\t// 浏览器是否支持该控件\n\t\t\tisSupported,\n\t\t\t// 浏览器是否支持触屏事件\n\t\t\tisSupportTouch: document.hasOwnProperty(\"ontouchstart\"),\n\n\t\t\t// 步骤\n\t\t\tstep: 1, //1选择文件 2剪裁 3上传\n\n\t\t\t// 上传状态及进度\n\t\t\tloading: 0, //0未开始 1正在 2成功 3错误\n\t\t\tprogress: 0,\n\n\t\t\t// 是否有错误及错误信息\n\t\t\thasError: false,\n\t\t\terrorMsg: '',\n\n\t\t\t// 需求图宽高比\n\t\t\tratio: width / height,\n\n\t\t\t// 原图地址、生成图片地址\n\t\t\tsourceImg: null,\n\t\t\tsourceImgUrl: this.initialImgUrl,\n\t\t\tcreateImgUrl: this.initialImgUrl,\n\n\t\t\t// 原图片拖动事件初始值\n\t\t\tsourceImgMouseDown: {\n\t\t\t\ton: false,\n\t\t\t\tmX: 0, //鼠标按下的坐标\n\t\t\t\tmY: 0,\n\t\t\t\tx: 0, //scale原图坐标\n\t\t\t\ty: 0\n\t\t\t},\n\n\t\t\t// 生成图片预览的容器大小\n\t\t\tpreviewContainer: {\n\t\t\t\twidth: 100,\n\t\t\t\theight: 100\n\t\t\t},\n\n\t\t\t// 原图容器宽高\n\t\t\tsourceImgContainer: { // sic\n\t\t\t\twidth: 240,\n\t\t\t\theight: 184 // 如果生成图比例与此一致会出现bug，先改成特殊的格式吧，哈哈哈\n\t\t\t},\n\n\t\t\t// 原图展示属性\n\t\t\tscale: {\n\t\t\t\tzoomAddOn: false, //按钮缩放事件开启\n\t\t\t\tzoomSubOn: false, //按钮缩放事件开启\n\t\t\t\trange: 1, //最大100\n\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0,\n\t\t\t\tmaxWidth: 0,\n\t\t\t\tmaxHeight: 0,\n\t\t\t\tminWidth: 0, //最宽\n\t\t\t\tminHeight: 0,\n\t\t\t\tnaturalWidth: 0, //原宽\n\t\t\t\tnaturalHeight: 0\n\t\t\t}\n\t\t}\n\t},\n\n\tcomputed: {\n\t\t// 进度条样式\n\t\tprogressStyle() {\n\t\t\tlet {\n\t\t\t\tprogress\n\t\t\t} = this;\n\t\t\treturn {\n\t\t\t\twidth: progress + '%'\n\t\t\t}\n\t\t},\n\t\t// 原图样式\n\t\tsourceImgStyle() {\n\t\t\tlet {\n\t\t\t\t\tscale,\n\t\t\t\t\tsourceImgMasking\n\t\t\t\t} = this,\n\t\t\t\ttop = scale.y + sourceImgMasking.y + 'px',\n\t\t\t\tleft = scale.x + sourceImgMasking.x + 'px';\n\t\t\treturn {\n\t\t\t\ttop,\n\t\t\t\tleft,\n\t\t\t\twidth: scale.width + 'px',\n\t\t\t\theight: scale.height + 'px',// 兼容 Opera\n\t\t\t}\n\t\t},\n\t\t// 原图蒙版属性\n\t\tsourceImgMasking() {\n\t\t\tlet {\n\t\t\t\t\twidth,\n\t\t\t\t\theight,\n\t\t\t\t\tratio,\n\t\t\t\t\tsourceImgContainer\n\t\t\t\t} = this,\n\t\t\t\tsic = sourceImgContainer,\n\t\t\t\tsicRatio = sic.width / sic.height, // 原图容器宽高比\n\t\t\t\tx = 0,\n\t\t\t\ty = 0,\n\t\t\t\tw = sic.width,\n\t\t\t\th = sic.height,\n\t\t\t\tscale = 1;\n\t\t\tif (ratio < sicRatio) {\n\t\t\t\tscale = sic.height / height;\n\t\t\t\tw = sic.height * ratio;\n\t\t\t\tx = (sic.width - w) / 2;\n\t\t\t}\n\t\t\tif (ratio > sicRatio) {\n\t\t\t\tscale = sic.width / width;\n\t\t\t\th = sic.width / ratio;\n\t\t\t\ty = (sic.height - h) / 2;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tscale, // 蒙版相对需求宽高的缩放\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t\twidth: w,\n\t\t\t\theight: h\n\t\t\t};\n\t\t},\n\t\t// 原图遮罩样式\n\t\tsourceImgShadeStyle() {\n\t\t\tlet {\n\t\t\t\t\tsourceImgMasking,\n\t\t\t\t\tsourceImgContainer\n\t\t\t\t} = this,\n\t\t\t\tsic = sourceImgContainer,\n\t\t\t\tsim = sourceImgMasking,\n\t\t\t\tw = sim.width == sic.width ? sim.width : (sic.width - sim.width) / 2,\n\t\t\t\th = sim.height == sic.height ? sim.height : (sic.height - sim.height) / 2;\n\t\t\treturn {\n\t\t\t\twidth: w + 'px',\n\t\t\t\theight: h + 'px'\n\t\t\t};\n\t\t},\n\t\tpreviewStyle() {\n\t\t\tlet {\n\t\t\t\t\twidth,\n\t\t\t\t\theight,\n\t\t\t\t\tratio,\n\t\t\t\t\tpreviewContainer\n\t\t\t\t} = this,\n\t\t\t\tpc = previewContainer,\n\t\t\t\tw = pc.width,\n\t\t\t\th = pc.height,\n\t\t\t\tpcRatio = w / h;\n\t\t\tif (ratio < pcRatio) {\n\t\t\t\tw = pc.height * ratio;\n\t\t\t}\n\t\t\tif (ratio > pcRatio) {\n\t\t\t\th = pc.width / ratio;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\twidth: w + 'px',\n\t\t\t\theight: h + 'px'\n\t\t\t};\n\t\t}\n\t},\n\n\twatch: {\n\t\tmodelValue(newValue) {\n\t\t\tif (newValue && this.loading != 1) {\n\t\t\t\tthis.reset();\n\t\t\t}\n\t\t}\n\t},\n\n\tcreated(){\n\t\t// 绑定按键esc隐藏此插件事件\n\t\tdocument.addEventListener('keyup', this.handleEscClose )\n\t},\n\n\tbeforeUnmount(){\n\t\tdocument.removeEventListener('keyup', this.handleEscClose )\n\t},\n\n\tmounted() {\n\t\tif (this.sourceImgUrl) {\n\t\t\tthis.startCrop();\n\t\t}\n\t},\n\n\tmethods: {\n\t\thandleEscClose(e){\n\t\t\tif(this.modelValue && (e.key == 'Escape' || e.keyCode == 27)){\n\t\t\t\tthis.off();\n\t\t\t}\n\t\t},\n\t\t// 点击波纹效果\n\t\tripple(e) {\n\t\t\teffectRipple(e);\n\t\t},\n\t\t// 关闭控件\n\t\toff() {\n\t\t\tsetTimeout(()=> {\n\t\t\t\tthis.$emit('update:modelValue', false);\n\t\t\t\tif(this.step == 3 && this.loading == 2){\n\t\t\t\t\tthis.setStep(1);\n\t\t\t\t}\n\t\t\t}, 200);\n\t\t},\n\t\t// 设置步骤\n\t\tsetStep(no) {\n\t\t\t// 延时是为了显示动画效果呢，哈哈哈\n\t\t\tsetTimeout(()=> {\n\t\t\t\tthis.step = no;\n\t\t\t}, 200);\n\t\t},\n\n\t\t/* 图片选择区域函数绑定\n\t\t ---------------------------------------------------------------*/\n\t\tpreventDefault(e) {\n\t\t\te.preventDefault();\n\t\t\treturn false;\n\t\t},\n\t\thandleClick(e) {\n\t\t\tif (this.loading !== 1) {\n\t\t\t\tif (e.target !== this.$refs.fileinput) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tif (document.activeElement !== this.$refs) {\n\t\t\t\t\t\tthis.$refs.fileinput.click();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\thandleChange(e) {\n\t\t\te.preventDefault();\n\t\t\tif (this.loading !== 1) {\n\t\t\t\tlet files = e.target.files || e.dataTransfer.files;\n\t\t\t\tthis.reset();\n\t\t\t\tif (this.checkFile(files[0])) {\n\t\t\t\t\tthis.setSourceImg(files[0]);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/* ---------------------------------------------------------------*/\n\n\t\t// 检测选择的文件是否合适\n\t\tcheckFile(file) {\n\t\t\tlet that = this,\n\t\t\t\t{\n\t\t\t\t\tlang,\n\t\t\t\t\tmaxSize\n\t\t\t\t} = that;\n\t\t\t// 仅限图片\n\t\t\tif (file.type.indexOf('image') === -1) {\n\t\t\t\tthat.hasError = true;\n\t\t\t\tthat.errorMsg = lang.error.onlyImg;\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// 超出大小\n\t\t\tif (file.size / 1024 > maxSize) {\n\t\t\t\tthat.hasError = true;\n\t\t\t\tthat.errorMsg = lang.error.outOfSize + maxSize + 'kb';\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\t// 重置控件\n\t\treset() {\n\t\t\tlet that = this;\n\t\t\tthat.loading = 0;\n\t\t\tthat.hasError = false;\n\t\t\tthat.errorMsg = '';\n\t\t\tthat.progress = 0;\n\t\t},\n\t\t// 设置图片源\n\t\tsetSourceImg(file) {\n\t\t\tthis.$emit('src-file-set', file.name, file.type, file.size);\n\t\t\tlet that = this,\n\t\t\t\tfr = new FileReader();\n\t\t\tfr.onload = function(e) {\n\t\t\t\tthat.sourceImgUrl = fr.result;\n\t\t\t\tthat.startCrop();\n\t\t\t}\n\t\t\tfr.readAsDataURL(file);\n\t\t},\n\t\t// 剪裁前准备工作\n\t\tstartCrop() {\n\t\t\tlet that = this,\n\t\t\t\t{\n\t\t\t\t\twidth,\n\t\t\t\t\theight,\n\t\t\t\t\tratio,\n\t\t\t\t\tscale,\n\t\t\t\t\tsourceImgUrl,\n\t\t\t\t\tsourceImgMasking,\n\t\t\t\t\tlang\n\t\t\t\t} = that,\n\t\t\t\tsim = sourceImgMasking,\n\t\t\t\timg = new Image();\n\t\t\timg.src = sourceImgUrl;\n\t\t\timg.onload = function() {\n\t\t\t\tlet nWidth = img.naturalWidth,\n\t\t\t\t\tnHeight = img.naturalHeight,\n\t\t\t\t\tnRatio = nWidth / nHeight,\n\t\t\t\t\tw = sim.width,\n\t\t\t\t\th = sim.height,\n\t\t\t\t\tx = 0,\n\t\t\t\t\ty = 0;\n\t\t\t\t// 图片像素不达标\n\t\t\t\tif (nWidth < width || nHeight < height) {\n\t\t\t\t\tthat.hasError = true;\n\t\t\t\t\tthat.errorMsg = lang.error.lowestPx + width + '*' + height;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (ratio > nRatio) {\n\t\t\t\t\th = w / nRatio;\n\t\t\t\t\ty = (sim.height - h) / 2;\n\t\t\t\t}\n\t\t\t\tif (ratio < nRatio) {\n\t\t\t\t\tw = h * nRatio;\n\t\t\t\t\tx = (sim.width - w) / 2;\n\t\t\t\t}\n\t\t\t\tscale.range = 0;\n\t\t\t\tscale.x = x;\n\t\t\t\tscale.y = y;\n\t\t\t\tscale.width = w;\n\t\t\t\tscale.height = h;\n\t\t\t\tscale.minWidth = w;\n\t\t\t\tscale.minHeight = h;\n\t\t\t\tscale.maxWidth = nWidth * sim.scale;\n\t\t\t\tscale.maxHeight = nHeight * sim.scale;\n\t\t\t\tscale.naturalWidth = nWidth;\n\t\t\t\tscale.naturalHeight = nHeight;\n\t\t\t\tthat.sourceImg = img;\n\t\t\t\tthat.createImg();\n\t\t\t\tthat.setStep(2);\n\t\t\t};\n\t\t},\n\t\t// 鼠标按下图片准备移动\n\t\timgStartMove(e) {\n\t\t\te.preventDefault();\n\t\t\t// 支持触摸事件，则鼠标事件无效\n\t\t\tif(this.isSupportTouch && !e.targetTouches){\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tlet et = e.targetTouches ? e.targetTouches[0] : e,\n\t\t\t\t{\n\t\t\t\t\tsourceImgMouseDown,\n\t\t\t\t\tscale\n\t\t\t\t} = this,\n\t\t\t\tsimd = sourceImgMouseDown;\n\t\t\tsimd.mX = et.screenX;\n\t\t\tsimd.mY = et.screenY;\n\t\t\tsimd.x = scale.x;\n\t\t\tsimd.y = scale.y;\n\t\t\tsimd.on = true;\n\t\t},\n\t\t// 鼠标按下状态下移动，图片移动\n\t\timgMove(e) {\n\t\t\te.preventDefault();\n\t\t\t// 支持触摸事件，则鼠标事件无效\n\t\t\tif(this.isSupportTouch && !e.targetTouches){\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tlet et = e.targetTouches ? e.targetTouches[0] : e,\n\t\t\t\t{\n\t\t\t\t\tsourceImgMouseDown: {\n\t\t\t\t\t\ton,\n\t\t\t\t\t\tmX,\n\t\t\t\t\t\tmY,\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty\n\t\t\t\t\t},\n\t\t\t\t\tscale,\n\t\t\t\t\tsourceImgMasking\n\t\t\t\t} = this,\n\t\t\t\tsim = sourceImgMasking,\n\t\t\t\tnX = et.screenX,\n\t\t\t\tnY = et.screenY,\n\t\t\t\tdX = nX - mX,\n\t\t\t\tdY = nY - mY,\n\t\t\t\trX = x + dX,\n\t\t\t\trY = y + dY;\n\t\t\tif (!on) return;\n\t\t\tif (rX > 0) {\n\t\t\t\trX = 0;\n\t\t\t}\n\t\t\tif (rY > 0) {\n\t\t\t\trY = 0;\n\t\t\t}\n\t\t\tif (rX < sim.width - scale.width) {\n\t\t\t\trX = sim.width - scale.width;\n\t\t\t}\n\t\t\tif (rY < sim.height - scale.height) {\n\t\t\t\trY = sim.height - scale.height;\n\t\t\t}\n\t\t\tscale.x = rX;\n\t\t\tscale.y = rY;\n\t\t},\n\t\t// 顺时针旋转图片\n        rotateImg(e) {\n\t\t\tlet {\n\t\t\t\t\tsourceImg,\n                    scale: {\n\t\t\t\t\t\tnaturalWidth,\n\t\t\t\t\t\tnaturalHeight,\n                    }\n                } = this,\n\t\t\t\twidth = naturalHeight,\n\t\t\t\theight = naturalWidth,\n                canvas = this.$refs.canvas,\n                ctx = canvas.getContext('2d');\n\t\t\tcanvas.width = width;\n            canvas.height = height;\n            ctx.clearRect(0, 0, width, height);\n\n\t\t\tctx.fillStyle = 'rgba(0,0,0,0)';\n\t\t\tctx.fillRect(0, 0, width, height);\n\n\t\t\tctx.translate(width, 0);\n            ctx.rotate(Math.PI * 90 / 180);\n\n            ctx.drawImage(sourceImg, 0, 0, naturalWidth, naturalHeight);\n            let imgUrl = canvas.toDataURL(mimes['png']);\n\n\t\t\tthis.sourceImgUrl = imgUrl;\n\t\t\tthis.startCrop();\n        },\n        handleMouseWheel(e){\n\t\t\te = e || window.event;\n\t\t\tlet \t{ scale } = this;\n\t\t\tif (e.wheelDelta) {  //判断浏览器IE，谷歌滑轮事件\n\t\t\t\tif (e.wheelDelta > 0) { //当滑轮向上滚动时\n\t\t\t\t\tthis.zoomImg(scale.range >= 100 ? 100 : ++scale.range);\n\t\t\t\t}\n\t\t\t\tif (e.wheelDelta < 0) {\n\t\t\t\t\tthis.zoomImg(scale.range <= 0 ? 0 : --scale.range);\n\t\t\t\t}\n\t\t\t} else if (e.detail) {  //Firefox滑轮事件\n\t\t\t\tif (e.detail > 0) { //当滑轮向上滚动时\n\t\t\t\t\tthis.zoomImg(scale.range >= 100 ? 100 : ++scale.range);\n\t\t\t\t}\n\t\t\t\tif (e.detail < 0) {\n\t\t\t\t\tthis.zoomImg(scale.range <= 0 ? 0 : --scale.range);\n\t\t\t\t}\n\t\t\t}\n        },\n\t\t// 按钮按下开始放大\n\t\tstartZoomAdd(e) {\n\t\t\tlet that = this,\n\t\t\t\t{\n\t\t\t\t\tscale\n\t\t\t\t} = that;\n\t\t\tscale.zoomAddOn = true;\n\n\t\t\tfunction zoom() {\n\t\t\t\tif (scale.zoomAddOn) {\n\t\t\t\t\tlet range = scale.range >= 100 ? 100 : ++scale.range;\n\t\t\t\t\tthat.zoomImg(range);\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\tzoom();\n\t\t\t\t\t}, 60);\n\t\t\t\t}\n\t\t\t}\n\t\t\tzoom();\n\t\t},\n\t\t// 按钮松开或移开取消放大\n\t\tendZoomAdd(e) {\n\t\t\tthis.scale.zoomAddOn = false;\n\t\t},\n\t\t// 按钮按下开始缩小\n\t\tstartZoomSub(e) {\n\t\t\tlet that = this,\n\t\t\t\t{\n\t\t\t\t\tscale\n\t\t\t\t} = that;\n\t\t\tscale.zoomSubOn = true;\n\n\t\t\tfunction zoom() {\n\t\t\t\tif (scale.zoomSubOn) {\n\t\t\t\t\tlet range = scale.range <= 0 ? 0 : --scale.range;\n\t\t\t\t\tthat.zoomImg(range);\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\tzoom();\n\t\t\t\t\t}, 60);\n\t\t\t\t}\n\t\t\t}\n\t\t\tzoom();\n\t\t},\n\t\t// 按钮松开或移开取消缩小\n\t\tendZoomSub(e) {\n\t\t\tlet {\n\t\t\t\tscale\n\t\t\t} = this;\n\t\t\tscale.zoomSubOn = false;\n\t\t},\n\t\tzoomChange(e) {\n\t\t\tthis.zoomImg(e.target.value);\n\t\t},\n\t\t// 缩放原图\n\t\tzoomImg(newRange) {\n\t\t\tlet that = this,\n\t\t\t\t{\n\t\t\t\t\tsourceImgMasking,\n\t\t\t\t\tsourceImgMouseDown,\n\t\t\t\t\tscale\n\t\t\t\t} = this,\n\t\t\t\t{\n\t\t\t\t\tmaxWidth,\n\t\t\t\t\tmaxHeight,\n\t\t\t\t\tminWidth,\n\t\t\t\t\tminHeight,\n\t\t\t\t\twidth,\n\t\t\t\t\theight,\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t\trange\n\t\t\t\t} = scale,\n\t\t\t\tsim = sourceImgMasking,\n\t\t\t\t// 蒙版宽高\n\t\t\t\tsWidth = sim.width,\n\t\t\t\tsHeight = sim.height,\n\t\t\t\t// 新宽高\n\t\t\t\tnWidth = minWidth + (maxWidth - minWidth) * newRange / 100,\n\t\t\t\tnHeight = minHeight + (maxHeight - minHeight) * newRange / 100,\n\t\t\t\t// 新坐标（根据蒙版中心点缩放）\n\t\t\t\tnX = sWidth / 2 - (nWidth / width) * (sWidth / 2 - x),\n\t\t\t\tnY = sHeight / 2 - (nHeight / height) * (sHeight / 2 - y);\n\n\t\t\t// 判断新坐标是否超过蒙版限制\n\t\t\tif (nX > 0) {\n\t\t\t\tnX = 0;\n\t\t\t}\n\t\t\tif (nY > 0) {\n\t\t\t\tnY = 0;\n\t\t\t}\n\t\t\tif (nX < sWidth - nWidth) {\n\t\t\t\tnX = sWidth - nWidth;\n\t\t\t}\n\t\t\tif (nY < sHeight - nHeight) {\n\t\t\t\tnY = sHeight - nHeight;\n\t\t\t}\n\n\t\t\t// 赋值处理\n\t\t\tscale.x = nX;\n\t\t\tscale.y = nY;\n\t\t\tscale.width = nWidth;\n\t\t\tscale.height = nHeight;\n\t\t\tscale.range = newRange;\n\t\t\tsetTimeout(function() {\n\t\t\t\tif (scale.range == newRange) {\n\t\t\t\t\tthat.createImg();\n\t\t\t\t}\n\t\t\t}, 300);\n\t\t},\n\t\t // 生成需求图片\n        createImg(e) {\n            let that = this,\n                {\n\t\t\t\t\timgFormat,\n\t\t\t\t\timgBgc,\n                    mime,\n                    sourceImg,\n                    scale: {\n                        x,\n                        y,\n                        width,\n                        height,\n                    },\n                    sourceImgMasking: {\n                        scale\n                    }\n                } = that,\n                canvas = that.$refs.canvas,\n                ctx = canvas.getContext('2d');\n            if (e) {\n                // 取消鼠标按下移动状态\n                that.sourceImgMouseDown.on = false;\n            }\n\t\t\tcanvas.width = that.width;\n            canvas.height = that.height;\n            ctx.clearRect(0, 0, that.width, that.height);\n\n\t\t\tif(imgFormat == 'png'){\n\t\t\t\tctx.fillStyle = 'rgba(0,0,0,0)';\n\t\t\t} else{\n\t\t\t\t// 如果jpg 为透明区域设置背景，默认白色\n\t\t\t\tctx.fillStyle = imgBgc;\n\t\t\t}\n\t\t\tctx.fillRect(0, 0, that.width, that.height);\n\n            ctx.drawImage(sourceImg, x / scale, y / scale, width / scale, height / scale);\n            that.createImgUrl = canvas.toDataURL(mime);\n        },\n\t\tprepareUpload(){\n\t\t\tlet {\n\t\t\t\turl,\n\t\t\t\tcreateImgUrl,\n\t\t\t\tfield,\n\t\t\t\tki\n\t\t\t} = this;\n\t\t\tthis.$emit('crop-success', createImgUrl, field, ki);\n\t\t\tif(typeof url == 'string' && url){\n\t\t\t\tthis.upload();\n\t\t\t}else{\n\t\t\t\tthis.off();\n\t\t\t}\n\t\t},\n\t\t// 上传图片\n\t\tupload() {\n\t\t\tlet that = this,\n\t\t\t\t{\n\t\t\t\t\tlang,\n\t\t\t\t\timgFormat,\n\t\t\t\t\tmime,\n\t\t\t\t\turl,\n\t\t\t\t\tparams,\n\t\t\t\t\theaders,\n\t\t\t\t\tfield,\n\t\t\t\t\tki,\n\t\t\t\t\tcreateImgUrl,\n\t\t\t\t\twithCredentials,\n\t\t\t\t\tmethod\n\t\t\t\t} = this,\n\t\t\t\tfmData = new FormData();\n\n\t\t\t// 添加其他参数\n\t\t\tif (typeof params == 'object' && params) {\n\t\t\t\tObject.keys(params).forEach((k) => {\n\t\t\t\t\tfmData.append(k, params[k]);\n\t\t\t\t})\n\t\t\t}\n\n\t\t\t// 将field的添加放到表单域的最后，以支持阿里云OSS的表单上传\n\t\t\tfmData.append(field, data2blob(createImgUrl, mime), field + '.' + imgFormat);\n\n\n\t\t\t// 监听进度回调\n\t\t\tconst uploadProgress = function(event) {\n\t\t\t\tif (event.lengthComputable) {\n\t\t\t\t\tthat.progress = 100 * Math.round(event.loaded) / event.total;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// 上传文件\n\t\t\tthat.reset();\n\t\t\tthat.loading = 1;\n\t\t\tthat.setStep(3);\n\t\t\tnew Promise(function(resolve, reject) {\n\t\t\t\tlet client = new XMLHttpRequest();\n\t\t\t\tclient.open(method, url, true);\n\t\t\t\tclient.withCredentials = withCredentials;\n\t\t\t\tclient.onreadystatechange = function() {\n\t\t\t\t\tif (this.readyState !== 4) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (this.status === 200 || this.status === 201 || this.staus ===202 ) {\n\t\t\t\t\t\tresolve(JSON.parse(this.responseText));\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(this.status);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tclient.upload.addEventListener(\"progress\", uploadProgress, false); //监听进度\n\t\t\t\t// 设置header\n\t\t\t\tif (typeof headers == 'object' && headers) {\n\t\t\t\t\tObject.keys(headers).forEach((k) => {\n\t\t\t\t\t\tclient.setRequestHeader(k, headers[k]);\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tclient.send(fmData);\n\t\t\t}).then(\n\t\t\t\t// 上传成功\n\t\t\t\tfunction(resData) {\n\t\t\t\t\tif (that.modelValue) {\n\t\t\t\t\t\tthat.loading = 2;\n\t\t\t\t\t\tthat.$emit('crop-upload-success', resData, field, ki);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t// 上传失败\n\t\t\t\tfunction(sts) {\n\t\t\t\t\tif (that.modelValue) {\n\t\t\t\t\t\tthat.loading = 3;\n\t\t\t\t\t\tthat.hasError = true;\n\t\t\t\t\t\tthat.errorMsg = lang.fail;\n\t\t\t\t\t\tthat.$emit('crop-upload-fail', sts, field, ki);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t},\n}\n\n</script>\n\n<!--\n<style lang='sass' src=\"./scss/upload.scss\">\n</style> -->\n\n<style>\n@import url('upload.css');\n</style>\n"]},"metadata":{},"sourceType":"module"}