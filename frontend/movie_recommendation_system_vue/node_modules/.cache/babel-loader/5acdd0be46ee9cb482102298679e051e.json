{"ast":null,"code":"import { ref } from \"vue\";\nimport authRequest from \"@/api/authentication\";\nimport { ErrorMessage, SuccessMessage } from \"@/utils/my-message\";\nimport { debounce } from \"@/utils/debounce-throttle\";\nexport default {\n  name: 'ForgetView',\n  components: {},\n  setup() {\n    let active = ref(0);\n    let username = ref('');\n    let newPassword = ref('');\n\n    // 邮箱\n    let mail = ref(\"\");\n    // 验证码\n    let authCode = ref(\"\");\n    // 是否可以点击“发送验证码”按钮，false表示可以\n    let isDisabled = ref(false);\n    // “发送验证码”按钮中的信息\n    let sendCodeBtnName = ref('发送验证码');\n    // 邮箱输入是否有误\n    let isInputError = ref(false);\n    const sendAuthCode = debounce(() => {\n      mail.value = mail.value.trim();\n      const regex = /^\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$/;\n      if (!regex.test(mail.value)) {\n        console.log(\"邮箱格式有误\");\n        isInputError.value = true;\n        const showErr = setInterval(() => {\n          isInputError.value = false;\n          clearInterval(showErr);\n        }, 1000);\n        return;\n      }\n      authRequest.getAuthCodeUnderLogout(username.value, mail.value).then(res => {\n        if (res.code === 200) {\n          SuccessMessage(res.msg);\n          // 60秒内不能再次发送验证码\n          sendCodeBtnName.value = \"60秒后可重发\";\n          let time = 60;\n          isDisabled.value = true;\n          const interval = setInterval(() => {\n            time--;\n            sendCodeBtnName.value = time + \"秒后可重发\";\n            // 60秒时间到后，将定时器清除，用户可以重新发送验证码\n            if (time === 0) {\n              clearInterval(interval);\n              sendCodeBtnName.value = '发送验证码';\n              isDisabled.value = false;\n            }\n          }, 1000);\n        } else {\n          ErrorMessage(res.msg);\n        }\n      }).catch(err => {\n        console.error(err);\n      });\n    });\n    const checkUsernameExists = debounce(() => {\n      username.value = username.value.trim();\n      authRequest.checkUsernameExists(username.value).then(res => {\n        if (res.code === 200) {\n          SuccessMessage(res.msg);\n          active.value++;\n        } else {\n          ErrorMessage(res.msg);\n        }\n      });\n    });\n    const checkAuthCode = debounce(() => {\n      username.value = username.value.trim();\n      authCode.value = authCode.value.trim();\n      authRequest.checkAuthCode(username.value, authCode.value).then(res => {\n        if (res.code === 200) {\n          SuccessMessage(res.msg);\n          authRequest.judgeAndFindPassword(username.value, authCode.value).then(res => {\n            if (res.code === 200) {\n              newPassword.value = res.data.password;\n              active.value++;\n            }\n          });\n        } else {\n          ErrorMessage(res.msg);\n        }\n      }).catch(err => {\n        console.error(err);\n      });\n    });\n    return {\n      active,\n      username,\n      newPassword,\n      mail,\n      authCode,\n      isDisabled,\n      sendCodeBtnName,\n      isInputError,\n      sendAuthCode,\n      checkUsernameExists,\n      checkAuthCode\n    };\n  }\n};","map":{"version":3,"mappings":"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","names":["ref","authRequest","ErrorMessage","SuccessMessage","debounce","name","components","setup","active","username","newPassword","mail","authCode","isDisabled","sendCodeBtnName","isInputError","sendAuthCode","value","trim","regex","test","console","log","showErr","setInterval","clearInterval","getAuthCodeUnderLogout","then","res","code","msg","time","interval","catch","err","error","checkUsernameExists","checkAuthCode","judgeAndFindPassword","data","password"],"sourceRoot":"","sources":["F:\\personalSpace\\lx-bishe\\movie_recommendation_system_vue\\src\\views\\ForgetView.vue"],"sourcesContent":["<template>\r\n  <div class=\"bg\"></div>\r\n  <div\r\n      class=\"login-form my-border\">\r\n\r\n    <div class=\"login-form-header\">\r\n      <router-link to=\"/home\">\r\n        <img style=\"width: 75px; height: 75px; float: left; padding-right: 40px;\" src=\"../assets/logo.png\" alt=\"logo\"/>\r\n      </router-link>\r\n\r\n      <div class=\"login-form-text\">电影推荐系统 - 忘记密码</div>\r\n    </div>\r\n\r\n    <div>\r\n      <el-steps :active=\"active\" finish-status=\"success\">\r\n        <el-step title=\"账 号\"/>\r\n        <el-step title=\"邮箱验证\"/>\r\n        <el-step title=\"完成\"/>\r\n      </el-steps>\r\n    </div>\r\n\r\n    <div v-if=\"active === 0\">\r\n      <el-input v-model=\"username\" placeholder=\"要找回的账号\" class=\"space\"></el-input>\r\n      <div class=\"space btn\">\r\n        <el-button @click=\"checkUsernameExists\" type=\"primary\">确 定</el-button>\r\n      </div>\r\n    </div>\r\n    <div v-else-if=\"active === 1\">\r\n      <el-input v-model=\"mail\" placeholder=\"请输入该账号对应的邮箱\" class=\"space\">\r\n        <template #append>\r\n          <el-popover :visible=\"isInputError\" placement=\"top\" hide-after=\"1000\">\r\n            <p style=\"width: 100%; text-align: center; color: red;\">邮箱格式有误！</p>\r\n            <template #reference>\r\n              <el-button :disabled=\"isDisabled\" @click=\"sendAuthCode\">{{ sendCodeBtnName }}</el-button>\r\n            </template>\r\n          </el-popover>\r\n        </template>\r\n      </el-input>\r\n      <br/>\r\n      <el-input v-model=\"authCode\" placeholder=\"验证码\" class=\"space input\"></el-input>\r\n      <div class=\"space btn\">\r\n        <el-button @click=\"active --\">上一步</el-button>\r\n        <el-button @click=\"checkAuthCode\" type=\"primary\">确 定</el-button>\r\n      </div>\r\n    </div>\r\n    <div v-else-if=\"active === 2\">\r\n      <h3>找回的密码：</h3>\r\n      <p style=\"width: 100%; text-align: center;\">{{ newPassword }}</p>\r\n      <p style=\"color: red\">注意：请记住找回的密码，并在登录后尽快修改！</p>\r\n      <p style=\"text-align: center;\">\r\n        <el-link type=\"info\" href=\"/login\">已记住密码，现在去登录</el-link>\r\n      </p>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {ref} from \"vue\";\r\nimport authRequest from \"@/api/authentication\";\r\nimport {ErrorMessage, SuccessMessage} from \"@/utils/my-message\";\r\nimport {debounce} from \"@/utils/debounce-throttle\";\r\n\r\nexport default {\r\n  name: 'ForgetView',\r\n  components: {},\r\n  setup() {\r\n    let active = ref(0);\r\n    let username = ref('');\r\n    let newPassword = ref('');\r\n\r\n    // 邮箱\r\n    let mail = ref(\"\");\r\n    // 验证码\r\n    let authCode = ref(\"\");\r\n    // 是否可以点击“发送验证码”按钮，false表示可以\r\n    let isDisabled = ref(false);\r\n    // “发送验证码”按钮中的信息\r\n    let sendCodeBtnName = ref('发送验证码');\r\n    // 邮箱输入是否有误\r\n    let isInputError = ref(false)\r\n    const sendAuthCode = debounce(() => {\r\n      mail.value = mail.value.trim()\r\n      const regex = /^\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$/;\r\n      if (!regex.test(mail.value)) {\r\n        console.log(\"邮箱格式有误\");\r\n        isInputError.value = true;\r\n        const showErr = setInterval(() => {\r\n          isInputError.value = false;\r\n          clearInterval(showErr)\r\n        }, 1000);\r\n        return;\r\n      }\r\n\r\n      authRequest.getAuthCodeUnderLogout(username.value, mail.value).then(res => {\r\n        if (res.code === 200) {\r\n          SuccessMessage(res.msg);\r\n          // 60秒内不能再次发送验证码\r\n          sendCodeBtnName.value = \"60秒后可重发\";\r\n          let time = 60;\r\n          isDisabled.value = true;\r\n          const interval = setInterval(() => {\r\n            time--;\r\n            sendCodeBtnName.value = time + \"秒后可重发\";\r\n            // 60秒时间到后，将定时器清除，用户可以重新发送验证码\r\n            if (time === 0) {\r\n              clearInterval(interval)\r\n              sendCodeBtnName.value = '发送验证码';\r\n              isDisabled.value = false;\r\n            }\r\n          }, 1000);\r\n        } else {\r\n          ErrorMessage(res.msg)\r\n        }\r\n      }).catch(err => {\r\n        console.error(err)\r\n      })\r\n    })\r\n\r\n    const checkUsernameExists = debounce(() => {\r\n      username.value = username.value.trim();\r\n      authRequest.checkUsernameExists(username.value).then(res => {\r\n        if (res.code === 200) {\r\n          SuccessMessage(res.msg)\r\n          active.value++;\r\n        } else {\r\n          ErrorMessage(res.msg)\r\n        }\r\n      })\r\n    })\r\n\r\n    const checkAuthCode = debounce(() => {\r\n      username.value = username.value.trim()\r\n      authCode.value = authCode.value.trim();\r\n      authRequest.checkAuthCode(username.value, authCode.value).then(res => {\r\n        if (res.code === 200) {\r\n          SuccessMessage(res.msg);\r\n\r\n          authRequest.judgeAndFindPassword(username.value, authCode.value).then(res => {\r\n            if (res.code === 200) {\r\n              newPassword.value = res.data.password\r\n              active.value++;\r\n            }\r\n          })\r\n        } else {\r\n          ErrorMessage(res.msg)\r\n        }\r\n      }).catch(err => {\r\n        console.error(err)\r\n      })\r\n    })\r\n\r\n    return {\r\n      active,\r\n      username,\r\n      newPassword,\r\n      mail,\r\n      authCode,\r\n      isDisabled,\r\n      sendCodeBtnName,\r\n      isInputError,\r\n      sendAuthCode,\r\n      checkUsernameExists,\r\n      checkAuthCode,\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.space {\r\n  margin: 0.5rem 0;\r\n}\r\n\r\n.btn {\r\n  display: flex;\r\n  justify-content: right;\r\n}\r\n\r\n.bg {\r\n  height: 100%;\r\n  width: 100%;\r\n  position: absolute;\r\n  background-size: cover;\r\n}\r\n\r\n.login-form {\r\n  width: 28rem;\r\n  position: absolute;\r\n  left: 50%;\r\n  top: 10rem;\r\n  transform: translate(-50%, 0);\r\n  padding: 2rem;\r\n  margin-top: 1rem;\r\n  letter-spacing: 2px;\r\n}\r\n\r\n.login-form-header {\r\n  height: 20px;\r\n  padding-left: 45px;\r\n  padding-bottom: 100px;\r\n}\r\n\r\n.login-form-text {\r\n  color: #000000;\r\n  font-weight: bold;\r\n  font-size: 1.4rem;\r\n  padding-top: 15px;\r\n}\r\n\r\n.login-form-input {\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.login-form-button {\r\n  border-radius: 3px;\r\n  width: 100%;\r\n  font-weight: 600;\r\n  font-size: 15px;\r\n  letter-spacing: 2px;\r\n  height: 3.5rem;\r\n  background: #5a84fd;\r\n  margin-top: 35px;\r\n}\r\n\r\n.login-form-button:hover {\r\n  box-shadow: 0 10px 30px #2156f6;\r\n  transition: 3s;\r\n}\r\n\r\n.scan-and-forget-div {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  margin-top: 10px;\r\n}\r\n\r\n.my-font {\r\n  font-weight: bolder;\r\n  font-size: 14px;\r\n  color: #91949c;\r\n}\r\n\r\n.my-font:hover {\r\n  color: #5a84fd;\r\n}\r\n\r\n.login-form-footer {\r\n  font-weight: bolder;\r\n  color: #91949c;\r\n  padding-top: 1.5rem;\r\n  text-align: center;\r\n}\r\n\r\n/deep/ .el-input__inner {\r\n  height: 3rem;\r\n}\r\n\r\n.el-checkbox {\r\n  color: #91949c;\r\n  font-weight: bolder;\r\n  font-size: 15px;\r\n}\r\n\r\n/deep/ .el-form-item__label {\r\n  color: #91949c;\r\n  font-weight: bold;\r\n}\r\n\r\n/deep/ .el-form-item {\r\n  align-items: baseline;\r\n}\r\n\r\n.bg-change {\r\n  background-color: #e74c3c;\r\n  animation: bg-color 20s infinite;\r\n  -webkit-animation: bg-color 20s infinite;\r\n}\r\n\r\n@-webkit-keyframes bg-color {\r\n  0% {\r\n    background-color: #f18f87;\r\n  }\r\n  20% {\r\n    background-color: #ead18c;\r\n  }\r\n  40% {\r\n    background-color: #8be1d1;\r\n  }\r\n  60% {\r\n    background-color: #8cbee1;\r\n  }\r\n  80% {\r\n    background-color: #cba2e1;\r\n  }\r\n  100% {\r\n    background-color: #f18f87;\r\n  }\r\n}\r\n\r\n@keyframes bg-color {\r\n  0% {\r\n    background-color: #f18f87;\r\n  }\r\n  20% {\r\n    background-color: #ead18c;\r\n  }\r\n  40% {\r\n    background-color: #8be1d1;\r\n  }\r\n  60% {\r\n    background-color: #8cbee1;\r\n  }\r\n  80% {\r\n    background-color: #cba2e1;\r\n  }\r\n  100% {\r\n    background-color: #f18f87;\r\n  }\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}