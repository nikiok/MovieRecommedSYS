{"ast":null,"code":"import AvatarEdit from \"@/components/personal/edit/AvatarEditing\";\nimport { onBeforeUnmount, reactive, ref } from \"vue\";\nimport { Edit } from \"@element-plus/icons\";\nimport userRequest from \"@/api/user\";\nimport { ErrorMessage, SuccessMessage, WarningMessage } from \"@/utils/my-message\";\nimport emitter from \"@/utils/event-bus\";\nimport LikeEditing from \"@/components/personal/edit/LikeEditing\";\nexport default {\n  name: \"PersonalInfoEditView\",\n  components: {\n    LikeEditing,\n    Edit,\n    AvatarEdit\n  },\n  setup() {\n    let user = reactive({\n      username: '',\n      nickname: '',\n      avatar: '',\n      sex: '2'\n    });\n\n    // 昵称部分\n    let isShowNickname = ref(false);\n    let newNickname = ref('');\n    let handleUpdateNickname = () => {\n      if (newNickname.value.length === 0) {\n        WarningMessage(\"昵称不能为空(ˉ﹃ˉ)\");\n      } else {\n        userRequest.updateUserNickname(newNickname.value).then(res => {\n          if (res.code === 200) {\n            SuccessMessage(res.msg);\n            user.nickname = newNickname.value;\n            isShowNickname.value = false;\n            emitter.emit('handleHeaderNicknameChange', {\n              nickname: newNickname.value\n            });\n          } else {\n            ErrorMessage(res.msg);\n          }\n        }).catch(err => {\n          console.error(err);\n        });\n      }\n    };\n\n    // 性别部分\n    let isShowSex = ref(false);\n    let newSex = ref(\"\");\n    let handleUpdateSex = () => {\n      userRequest.updateUserSex(newSex.value).then(res => {\n        if (res.code === 200) {\n          SuccessMessage(res.msg);\n          user.sex = newSex.value;\n          isShowSex.value = false;\n        } else {\n          ErrorMessage(res.msg);\n        }\n      }).catch(err => {\n        console.error(err);\n      });\n    };\n\n    // 类型部分\n    let types = ref([]);\n    // 地区部分\n    let regions = ref([]);\n\n    /**\r\n     * 初始化界面，数据请求\r\n     */\n    userRequest.getUserInfo().then(res => {\n      if (res.code === 200) {\n        let userInfo = res.data;\n        user.username = userInfo.username;\n        user.nickname = userInfo.nickname;\n        user.avatar = userInfo.avatar;\n        user.sex = userInfo.sex;\n        newSex.value = userInfo.sex;\n\n        // 全局事件总线——触发：从服务器获取到个人信息后，将头像路径传递给Avatar.vue\n        emitter.emit('handleEditAvatarChange', {\n          avatar: user.avatar\n        });\n      } else {\n        ErrorMessage(res.msg);\n      }\n    }).catch(err => {\n      console.error(err);\n    });\n    const getTypesAndRegions = () => {\n      userRequest.getTypesAndRegions().then(res => {\n        if (res.code === 200) {\n          types.value = res.data.types;\n          regions.value = res.data.regions;\n        }\n      }).catch(err => {\n        console.error(err);\n      });\n    };\n    // 初始化时，获取用户的电影类型和地区喜好\n    getTypesAndRegions();\n    emitter.on('handleLikeEditingUpdate', data => {\n      // 用户触发喜好更新时，重新获取更新后的电影类型和地区喜好\n      setTimeout(() => {\n        getTypesAndRegions();\n      }, 200);\n    });\n    onBeforeUnmount(() => {\n      emitter.off('handleLikeEditingUpdate');\n    });\n    return {\n      user,\n      types,\n      regions,\n      isShowNickname,\n      newNickname,\n      handleUpdateNickname,\n      isShowSex,\n      newSex,\n      handleUpdateSex\n    };\n  }\n};","map":{"version":3,"mappings":"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","names":["AvatarEdit","onBeforeUnmount","reactive","ref","Edit","userRequest","ErrorMessage","SuccessMessage","WarningMessage","emitter","LikeEditing","name","components","setup","user","username","nickname","avatar","sex","isShowNickname","newNickname","handleUpdateNickname","value","length","updateUserNickname","then","res","code","msg","emit","catch","err","console","error","isShowSex","newSex","handleUpdateSex","updateUserSex","types","regions","getUserInfo","userInfo","data","getTypesAndRegions","on","setTimeout","off"],"sourceRoot":"","sources":["F:\\personalSpace\\lx-bishe\\movie_recommendation_system_vue\\src\\views\\personal\\PersonalInfoEditingView.vue"],"sourcesContent":["<template>\r\n  <div class=\"bg\">\r\n    <div class=\"info-edit-master\">\r\n      <router-link to=\"/personal\" class=\"back-to-my-home\">返回我的主页></router-link>\r\n\r\n      <div class=\"edit-top\">\r\n        <avatar-edit :size=\"12\" class=\"avatar\"></avatar-edit>\r\n        <div class=\"username-div\">{{ user.username }}</div>\r\n      </div>\r\n\r\n      <div class=\"edit-bottom\">\r\n        <el-divider/>\r\n\r\n        <div class=\"nickname-div\">\r\n          <div class=\"like\">昵称</div>\r\n          <!-- 昵称展示 -->\r\n          <div v-show=\"!isShowNickname\" class=\"content\">\r\n            <span class=\"each\">{{ user.nickname }}</span>\r\n            <span @click=\"isShowNickname = !isShowNickname\" class=\"edit-btn\">\r\n            <el-icon><edit/></el-icon>修改\r\n          </span>\r\n          </div>\r\n\r\n          <!-- 昵称编辑 -->\r\n          <div v-show=\"isShowNickname\" class=\"editing\">\r\n            <el-input\r\n                maxlength=\"10\"\r\n                placeholder=\"请输入更新后的昵称\"\r\n                show-word-limit\r\n                v-model=\"newNickname\" clearable\r\n                class=\"editing-input\">\r\n            </el-input>\r\n            <el-button @click=\"handleUpdateNickname\" type=\"primary\" class=\"editing-btn\">保存</el-button>\r\n            <el-button @click=\"isShowNickname = !isShowNickname\" class=\"editing-btn\">取消</el-button>\r\n          </div>\r\n        </div>\r\n\r\n        <el-divider/>\r\n\r\n        <div class=\"sex\">\r\n          <div class=\"like\">性别</div>\r\n          <!-- 性别展示 -->\r\n          <div v-show=\"!isShowSex\" class=\"content\">\r\n            <span class=\"each\">\r\n              <span v-if=\"user.sex === '男'\">男</span>\r\n              <span v-else-if=\"user.sex === '女'\">女</span>\r\n              <span v-else>保密</span>\r\n            </span>\r\n            <span @click=\"isShowSex = !isShowSex\" class=\"edit-btn\">\r\n              <el-icon><edit/></el-icon>修改\r\n            </span>\r\n          </div>\r\n          <!-- 性别编辑 -->\r\n          <div v-show=\"isShowSex\" class=\"editing\">\r\n            <el-radio-group class=\"editing-input\" v-model=\"newSex\">\r\n              <el-radio label=\"男\">男</el-radio>\r\n              <el-radio label=\"女\">女</el-radio>\r\n              <el-radio label=\"保密\">保密</el-radio>\r\n            </el-radio-group>\r\n            <div>\r\n              <el-button @click=\"handleUpdateSex\" type=\"primary\" class=\"editing-btn\">保存</el-button>\r\n              <el-button @click=\"isShowSex = !isShowSex\" class=\"editing-btn\">取消</el-button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <el-divider/>\r\n\r\n        <div class=\"types\">\r\n          <div class=\"like\">类型喜好</div>\r\n          <el-tag\r\n              v-for=\"(type, index) in types\"\r\n              :key=\"index\"\r\n              class=\"each\"\r\n              type=\"info\"\r\n              effect=\"dark\"\r\n          >\r\n            {{ type }}\r\n          </el-tag>\r\n\r\n          <like-editing :opt=\"1\"\r\n                        :likes=\"types\"/>\r\n        </div>\r\n\r\n        <el-divider/>\r\n\r\n        <div class=\"regions\">\r\n          <div class=\"like\">地区喜好</div>\r\n          <el-tag\r\n              v-for=\"(region, index) in regions\"\r\n              :key=\"index\"\r\n              class=\"each\"\r\n              type=\"info\"\r\n              effect=\"dark\"\r\n          >\r\n            {{ region }}\r\n          </el-tag>\r\n\r\n          <like-editing :opt=\"2\"\r\n                        :likes=\"regions\"/>\r\n        </div>\r\n\r\n        <el-divider/>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport AvatarEdit from \"@/components/personal/edit/AvatarEditing\";\r\nimport {onBeforeUnmount, reactive, ref} from \"vue\";\r\nimport {Edit} from \"@element-plus/icons\";\r\nimport userRequest from \"@/api/user\";\r\nimport {ErrorMessage, SuccessMessage, WarningMessage} from \"@/utils/my-message\";\r\nimport emitter from \"@/utils/event-bus\";\r\nimport LikeEditing from \"@/components/personal/edit/LikeEditing\";\r\n\r\nexport default {\r\n  name: \"PersonalInfoEditView\",\r\n  components: {LikeEditing, Edit, AvatarEdit},\r\n  setup() {\r\n    let user = reactive({\r\n      username: '',\r\n      nickname: '',\r\n      avatar: '',\r\n      sex: '2',\r\n    })\r\n\r\n    // 昵称部分\r\n    let isShowNickname = ref(false)\r\n    let newNickname = ref('')\r\n    let handleUpdateNickname = () => {\r\n      if (newNickname.value.length === 0) {\r\n        WarningMessage(\"昵称不能为空(ˉ﹃ˉ)\")\r\n      } else {\r\n        userRequest.updateUserNickname(newNickname.value).then(res => {\r\n          if (res.code === 200) {\r\n            SuccessMessage(res.msg);\r\n            user.nickname = newNickname.value\r\n            isShowNickname.value = false;\r\n\r\n            emitter.emit('handleHeaderNicknameChange', {\r\n              nickname: newNickname.value\r\n            })\r\n          } else {\r\n            ErrorMessage(res.msg);\r\n          }\r\n        }).catch(err => {\r\n          console.error(err)\r\n        })\r\n      }\r\n    }\r\n\r\n    // 性别部分\r\n    let isShowSex = ref(false)\r\n    let newSex = ref(\"\")\r\n    let handleUpdateSex = () => {\r\n      userRequest.updateUserSex(newSex.value).then(res => {\r\n        if (res.code === 200) {\r\n          SuccessMessage(res.msg);\r\n          user.sex = newSex.value\r\n          isShowSex.value = false;\r\n        } else {\r\n          ErrorMessage(res.msg);\r\n        }\r\n      }).catch(err => {\r\n        console.error(err)\r\n      })\r\n    }\r\n\r\n    // 类型部分\r\n    let types = ref([])\r\n    // 地区部分\r\n    let regions = ref([])\r\n\r\n    /**\r\n     * 初始化界面，数据请求\r\n     */\r\n    userRequest.getUserInfo().then(res => {\r\n      if (res.code === 200) {\r\n        let userInfo = res.data\r\n        user.username = userInfo.username\r\n        user.nickname = userInfo.nickname\r\n        user.avatar = userInfo.avatar\r\n        user.sex = userInfo.sex\r\n        newSex.value = userInfo.sex\r\n\r\n        // 全局事件总线——触发：从服务器获取到个人信息后，将头像路径传递给Avatar.vue\r\n        emitter.emit('handleEditAvatarChange', {\r\n          avatar: user.avatar\r\n        })\r\n      } else {\r\n        ErrorMessage(res.msg)\r\n      }\r\n    }).catch(err => {\r\n      console.error(err)\r\n    })\r\n\r\n    const getTypesAndRegions = () => {\r\n      userRequest.getTypesAndRegions().then(res => {\r\n        if (res.code === 200) {\r\n          types.value = res.data.types\r\n          regions.value = res.data.regions\r\n        }\r\n      }).catch(err => {\r\n        console.error(err)\r\n      })\r\n    }\r\n    // 初始化时，获取用户的电影类型和地区喜好\r\n    getTypesAndRegions()\r\n\r\n    emitter.on('handleLikeEditingUpdate', data => {\r\n      // 用户触发喜好更新时，重新获取更新后的电影类型和地区喜好\r\n      setTimeout(() => {\r\n        getTypesAndRegions()\r\n      }, 200)\r\n    })\r\n\r\n    onBeforeUnmount(() => {\r\n      emitter.off('handleLikeEditingUpdate')\r\n    })\r\n\r\n    return {\r\n      user,\r\n      types,\r\n      regions,\r\n      isShowNickname,\r\n      newNickname,\r\n      handleUpdateNickname,\r\n      isShowSex,\r\n      newSex,\r\n      handleUpdateSex,\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.bg {\r\n  min-height: 89.6vh;\r\n  padding-left: 20%;\r\n  padding-right: 20%;\r\n  background-color: #d6dbe7;\r\n}\r\n\r\n.info-edit-master {\r\n  min-height: 89.5vh;\r\n  border-style: solid;\r\n  border-width: 1px;\r\n  padding: 0 1rem;\r\n  border-color: #dcdbdb;\r\n  background-color: white;\r\n\r\n  .back-to-my-home {\r\n    position: absolute;\r\n    right: 23%;\r\n    padding-top: 1rem;\r\n    color: rgb(133, 144, 166);\r\n    text-decoration: none;\r\n  }\r\n}\r\n\r\n.edit-top {\r\n  display: flex;\r\n  align-items: flex-end;\r\n\r\n  .username-div {\r\n    display: flex;\r\n    color: rgb(18, 18, 18);\r\n    font-size: 2.5rem;\r\n    font-weight: bold;\r\n    padding-left: 1rem;\r\n  }\r\n}\r\n\r\n.edit-bottom {\r\n  .content {\r\n    display: flex;\r\n  }\r\n\r\n  .sex, .types, .regions, .nickname-div {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n  }\r\n\r\n  .each {\r\n    margin-left: 1rem;\r\n  }\r\n\r\n  .like {\r\n    font-weight: 600;\r\n    color: rgb(68, 68, 68);\r\n    font-size: 1.1rem;\r\n    width: 6rem;\r\n  }\r\n}\r\n\r\n.edit-btn {\r\n  margin-left: 1rem;\r\n  display: flex;\r\n  align-items: center;\r\n  color: rgb(23, 81, 153);\r\n  white-space: nowrap;\r\n  cursor: pointer; // 鼠标放上去显示手势\r\n}\r\n\r\n// 编辑状态样式\r\n.editing {\r\n  padding-left: 0.5rem;\r\n  max-width: 18rem;\r\n\r\n  .editing-input {\r\n    margin-left: 1rem;\r\n    margin-bottom: 1rem;\r\n  }\r\n\r\n  .editing-btn {\r\n    margin-left: 1rem;\r\n  }\r\n}\r\n\r\n@media screen and (max-width: 800px) {\r\n  .bg {\r\n    padding: 0 0;\r\n  }\r\n\r\n  .back-to-my-home {\r\n    position: relative;\r\n    left: 77%;\r\n    white-space: nowrap;\r\n    padding-top: 1rem;\r\n    color: rgb(133, 144, 166);\r\n    text-decoration: none;\r\n  }\r\n}\r\n\r\n</style>"]},"metadata":{},"sourceType":"module"}