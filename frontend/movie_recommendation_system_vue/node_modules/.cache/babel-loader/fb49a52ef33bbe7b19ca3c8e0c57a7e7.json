{"ast":null,"code":"import { isVNode, createVNode, render } from 'vue';\nimport { isClient, isNumber } from '@vueuse/core';\nimport '../../../utils/index.mjs';\nimport '../../../hooks/index.mjs';\nimport { messageConfig } from '../../config-provider/src/config-provider.mjs';\nimport MessageConstructor from './message2.mjs';\nimport { messageTypes } from './message.mjs';\nimport { isObject, isString, isFunction } from '@vue/shared';\nimport { useZIndex } from '../../../hooks/use-z-index/index.mjs';\nimport { isElement } from '../../../utils/types.mjs';\nimport { debugWarn } from '../../../utils/error.mjs';\nconst instances = [];\nlet seed = 1;\nconst message = function (options = {}, context) {\n  if (!isClient) return {\n    close: () => void 0\n  };\n  if (isNumber(messageConfig.max) && instances.length >= messageConfig.max) {\n    return {\n      close: () => void 0\n    };\n  }\n  if (!isVNode(options) && isObject(options) && options.grouping && !isVNode(options.message) && instances.length) {\n    const tempVm = instances.find(item => {\n      var _a, _b, _c;\n      return `${(_b = (_a = item.vm.props) == null ? void 0 : _a.message) != null ? _b : \"\"}` === `${(_c = options.message) != null ? _c : \"\"}`;\n    });\n    if (tempVm) {\n      tempVm.vm.component.props.repeatNum += 1;\n      tempVm.vm.component.props.type = options == null ? void 0 : options.type;\n      return {\n        close: () => vm.component.proxy.visible = false\n      };\n    }\n  }\n  if (isString(options) || isVNode(options)) {\n    options = {\n      message: options\n    };\n  }\n  let verticalOffset = options.offset || 20;\n  instances.forEach(({\n    vm: vm2\n  }) => {\n    var _a;\n    verticalOffset += (((_a = vm2.el) == null ? void 0 : _a.offsetHeight) || 0) + 16;\n  });\n  verticalOffset += 16;\n  const {\n    nextZIndex\n  } = useZIndex();\n  const id = `message_${seed++}`;\n  const userOnClose = options.onClose;\n  const props = {\n    zIndex: nextZIndex(),\n    ...options,\n    offset: verticalOffset,\n    id,\n    onClose: () => {\n      close(id, userOnClose);\n    }\n  };\n  let appendTo = document.body;\n  if (isElement(options.appendTo)) {\n    appendTo = options.appendTo;\n  } else if (isString(options.appendTo)) {\n    appendTo = document.querySelector(options.appendTo);\n  }\n  if (!isElement(appendTo)) {\n    debugWarn(\"ElMessage\", \"the appendTo option is not an HTMLElement. Falling back to document.body.\");\n    appendTo = document.body;\n  }\n  const container = document.createElement(\"div\");\n  container.className = `container_${id}`;\n  const messageContent = props.message;\n  const vm = createVNode(MessageConstructor, props, isFunction(messageContent) ? {\n    default: messageContent\n  } : isVNode(messageContent) ? {\n    default: () => messageContent\n  } : null);\n  vm.appContext = context || message._context;\n  vm.props.onDestroy = () => {\n    render(null, container);\n  };\n  render(vm, container);\n  instances.push({\n    vm\n  });\n  appendTo.appendChild(container.firstElementChild);\n  return {\n    close: () => vm.component.proxy.visible = false\n  };\n};\nmessageTypes.forEach(type => {\n  message[type] = (options = {}, appContext) => {\n    if (isString(options) || isVNode(options)) {\n      options = {\n        message: options\n      };\n    }\n    return message({\n      ...options,\n      type\n    }, appContext);\n  };\n});\nfunction close(id, userOnClose) {\n  const idx = instances.findIndex(({\n    vm: vm2\n  }) => id === vm2.component.props.id);\n  if (idx === -1) return;\n  const {\n    vm\n  } = instances[idx];\n  if (!vm) return;\n  userOnClose == null ? void 0 : userOnClose(vm);\n  const removedHeight = vm.el.offsetHeight;\n  instances.splice(idx, 1);\n  const len = instances.length;\n  if (len < 1) return;\n  for (let i = idx; i < len; i++) {\n    const pos = Number.parseInt(instances[i].vm.el.style[\"top\"], 10) - removedHeight - 16;\n    instances[i].vm.component.props.offset = pos;\n  }\n}\nfunction closeAll() {\n  var _a;\n  for (let i = instances.length - 1; i >= 0; i--) {\n    const instance = instances[i].vm.component;\n    (_a = instance == null ? void 0 : instance.proxy) == null ? void 0 : _a.close();\n  }\n}\nmessage.closeAll = closeAll;\nmessage._context = null;\nexport { close, closeAll, message as default };","map":{"version":3,"mappings":"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","names":["instances","seed","message","options","context","isClient","close","isNumber","messageConfig","max","length","isVNode","isObject","grouping","tempVm","find","item","_a","_b","_c","vm","props","component","repeatNum","type","proxy","visible","isString","verticalOffset","offset","forEach","vm2","el","offsetHeight","nextZIndex","useZIndex","id","userOnClose","onClose","zIndex","appendTo","document","body","isElement","querySelector","debugWarn","container","createElement","className","messageContent","createVNode","MessageConstructor","isFunction","default","appContext","_context","onDestroy","render","push","appendChild","firstElementChild","messageTypes","idx","findIndex","removedHeight","splice","len","i","pos","Number","parseInt","style","closeAll","instance"],"sources":["../../../../../../packages/components/message/src/message-method.ts"],"sourcesContent":["import { createVNode, render } from 'vue'\nimport { isClient } from '@vueuse/core'\nimport {\n  isVNode,\n  isNumber,\n  isObject,\n  isString,\n  isElement,\n  debugWarn,\n  isFunction,\n} from '@element-plus/utils'\nimport { useZIndex } from '@element-plus/hooks'\nimport { messageConfig } from '@element-plus/components/config-provider/src/config-provider'\nimport MessageConstructor from './message.vue'\nimport { messageTypes } from './message'\n\nimport type { AppContext, ComponentPublicInstance, VNode } from 'vue'\nimport type { Message, MessageFn, MessageQueue, MessageProps } from './message'\n\nconst instances: MessageQueue = []\nlet seed = 1\n\n// TODO: Since Notify.ts is basically the same like this file. So we could do some encapsulation against them to reduce code duplication.\n\nconst message: MessageFn & Partial<Message> & { _context: AppContext | null } =\n  function (options = {}, context?: AppContext | null) {\n    if (!isClient) return { close: () => undefined }\n    if (isNumber(messageConfig.max) && instances.length >= messageConfig.max) {\n      return { close: () => undefined }\n    }\n\n    if (\n      !isVNode(options) &&\n      isObject(options) &&\n      options.grouping &&\n      !isVNode(options.message) &&\n      instances.length\n    ) {\n      const tempVm: any = instances.find(\n        (item) =>\n          `${item.vm.props?.message ?? ''}` ===\n          `${(options as any).message ?? ''}`\n      )\n      if (tempVm) {\n        tempVm.vm.component!.props.repeatNum += 1\n        tempVm.vm.component!.props.type = options?.type\n        return {\n          close: () =>\n            ((\n              vm.component!.proxy as ComponentPublicInstance<{\n                visible: boolean\n              }>\n            ).visible = false),\n        }\n      }\n    }\n\n    if (isString(options) || isVNode(options)) {\n      options = { message: options }\n    }\n\n    let verticalOffset = options.offset || 20\n    instances.forEach(({ vm }) => {\n      verticalOffset += (vm.el?.offsetHeight || 0) + 16\n    })\n    verticalOffset += 16\n\n    const { nextZIndex } = useZIndex()\n\n    const id = `message_${seed++}`\n    const userOnClose = options.onClose\n    const props: Partial<MessageProps> = {\n      zIndex: nextZIndex(),\n      ...options,\n      offset: verticalOffset,\n      id,\n      onClose: () => {\n        close(id, userOnClose)\n      },\n    }\n\n    let appendTo: HTMLElement | null = document.body\n    if (isElement(options.appendTo)) {\n      appendTo = options.appendTo\n    } else if (isString(options.appendTo)) {\n      appendTo = document.querySelector(options.appendTo)\n    }\n    // should fallback to default value with a warning\n    if (!isElement(appendTo)) {\n      debugWarn(\n        'ElMessage',\n        'the appendTo option is not an HTMLElement. Falling back to document.body.'\n      )\n      appendTo = document.body\n    }\n\n    const container = document.createElement('div')\n\n    container.className = `container_${id}`\n\n    const messageContent = props.message\n    const vm = createVNode(\n      MessageConstructor,\n      props,\n      isFunction(messageContent)\n        ? { default: messageContent }\n        : isVNode(messageContent)\n        ? { default: () => messageContent }\n        : null\n    )\n\n    vm.appContext = context || message._context\n\n    // clean message element preventing mem leak\n    vm.props!.onDestroy = () => {\n      render(null, container)\n      // since the element is destroy, then the VNode should be collected by GC as well\n      // we do not want cause any mem leak because we have returned vm as a reference to users\n      // so that we manually set it to false.\n    }\n\n    render(vm, container)\n    // instances will remove this item when close function gets called. So we do not need to worry about it.\n    instances.push({ vm })\n    appendTo.appendChild(container.firstElementChild!)\n\n    return {\n      // instead of calling the onClose function directly, setting this value so that we can have the full lifecycle\n      // for out component, so that all closing steps will not be skipped.\n      close: () =>\n        ((\n          vm.component!.proxy as ComponentPublicInstance<{ visible: boolean }>\n        ).visible = false),\n    }\n  }\n\nmessageTypes.forEach((type) => {\n  message[type] = (options = {}, appContext?: AppContext | null) => {\n    if (isString(options) || isVNode(options)) {\n      options = {\n        message: options,\n      }\n    }\n    return message(\n      {\n        ...options,\n        type,\n      },\n      appContext\n    )\n  }\n})\n\nexport function close(id: string, userOnClose?: (vm: VNode) => void): void {\n  const idx = instances.findIndex(({ vm }) => id === vm.component!.props.id)\n  if (idx === -1) return\n\n  const { vm } = instances[idx]\n  if (!vm) return\n  userOnClose?.(vm)\n\n  const removedHeight = vm.el!.offsetHeight\n  instances.splice(idx, 1)\n\n  // adjust other instances vertical offset\n  const len = instances.length\n  if (len < 1) return\n  for (let i = idx; i < len; i++) {\n    const pos =\n      Number.parseInt(instances[i].vm.el!.style['top'], 10) - removedHeight - 16\n\n    instances[i].vm.component!.props.offset = pos\n  }\n}\n\nexport function closeAll(): void {\n  for (let i = instances.length - 1; i >= 0; i--) {\n    const instance = instances[i].vm.component\n    ;(instance?.proxy as any)?.close()\n  }\n}\n\nmessage.closeAll = closeAll\nmessage._context = null\n\nexport default message as Message\n"]},"metadata":{},"sourceType":"module"}