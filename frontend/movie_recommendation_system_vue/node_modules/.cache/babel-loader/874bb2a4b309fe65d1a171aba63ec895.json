{"ast":null,"code":"import { PictureRounded, Menu as IconMenu, Grid as IconGrid, List as IconList } from \"@element-plus/icons-vue\";\nimport MovieCard from \"@/components/basic/MovieCard\";\nimport { onBeforeUnmount, onMounted, reactive, ref, toRaw, watch } from \"vue\";\nimport MovieStrip from \"@/components/basic/MovieStrip\";\nimport emitter from \"@/utils/event-bus\";\nimport movieRequest from \"@/api/movie\";\nimport { ErrorMessage } from \"@/utils/my-message\";\nimport { useRouter } from \"vue-router\";\nimport BlankPage from \"@/components/basic/BlankPage\";\nexport default {\n  // 这里用来纪念一下困扰我多天的低级错误，把MovieCard.vue 和 MovieCards.vue的name都写成了MovieCard，导致递归堆栈溢出问题！！！\n  name: \"MovieCards\",\n  components: {\n    BlankPage,\n    IconMenu,\n    IconGrid,\n    IconList,\n    PictureRounded,\n    MovieCard,\n    MovieStrip\n  },\n  setup() {\n    const router = useRouter();\n    let loading = ref(false);\n\n    // 分页结果，电影列表\n    let movies = ref([]);\n\n    // 分页查询需要用到的一些数据\n    let currentPage = ref(1); // 当前页码\n    let pageSize = ref(12); // 每页电影数量\n    let total = ref(movies.value.length); // 总电影数\n    let type = ref('全部'); // 电影类型\n    let region = ref('全部'); // 电影地区\n    let searchWord = ref(''); // 搜索关键字\n\n    /**\r\n     * 向服务器请求电影数据\r\n     */\n    let getMovies = () => {\n      loading.value = true;\n      movies.value = [];\n      movieRequest.getMovies(currentPage.value, pageSize.value, type.value, region.value, searchWord.value).then(res => {\n        if (res.code === 200) {\n          movies.value = res.data.records;\n          total.value = res.data.total;\n        }\n        loading.value = false;\n      }).catch(err => {\n        ErrorMessage(err);\n      });\n    };\n\n    // 初始化页面时，获取电影信息列表\n    let keywords = ref(router.currentRoute.value.query.keywords);\n    onMounted(() => {\n      if (keywords.value === undefined) {\n        getMovies();\n      } else {\n        searchWord.value = keywords.value;\n        getMovies();\n      }\n    });\n\n    /**\r\n     * 监听`当前页码`变化\r\n     * 若页码发生变化，重新请求电影数据，随后页面发生变化。\r\n     */\n    watch(currentPage, (newValue, oldValue) => {\n      // 页面回到顶部（兼容不同浏览器）\n      document.body.scrollTop = 0;\n      document.documentElement.scrollTop = 0;\n      window.scrollTo(0, 0);\n      getMovies();\n    });\n\n    /**\r\n     * 监听`每页电影数量`变化（可扩展）\r\n     * 若发生变化，重新请求电影数据，随后页面发生变化。\r\n     */\n    watch(pageSize, (newValue, oldValue) => {});\n\n    /**\r\n     * 全局事件总线\r\n     * 监听MovieTags.vue中的type和region的变化\r\n     */\n    emitter.on('handleTypeOrRegionChange', data => {\n      type.value = data.type;\n      region.value = data.region;\n      currentPage.value = 1;\n      getMovies();\n    });\n\n    /**\r\n     * 全局事件总线\r\n     * 监听MovieHeader.vue中的keywords变化\r\n     */\n    emitter.on('handleSearch', data => {\n      searchWord.value = data.searchKeywords;\n      getMovies();\n    });\n\n    // 电影 卡片 or 长条 开关值，true为卡片，false为长条\n    let isCard = ref(true);\n    let listColor = ref('');\n    let gridColor = ref('#13ce66');\n    let handleSwitch = val => {\n      if (!val) {\n        listColor.value = '#36a4ff';\n        gridColor.value = '';\n      } else {\n        listColor.value = '';\n        gridColor.value = '#13ce66';\n      }\n    };\n    onBeforeUnmount(() => {\n      emitter.off('handleTypeOrRegionChange');\n      emitter.off('handleSearch');\n    });\n    return {\n      loading,\n      pageSize,\n      currentPage,\n      total,\n      movies,\n      isCard,\n      listColor,\n      gridColor,\n      getMovies,\n      handleSwitch\n    };\n  }\n};","map":{"version":3,"mappings":"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","names":["PictureRounded","Menu","IconMenu","Grid","IconGrid","List","IconList","MovieCard","onBeforeUnmount","onMounted","reactive","ref","toRaw","watch","MovieStrip","emitter","movieRequest","ErrorMessage","useRouter","BlankPage","name","components","setup","router","loading","movies","currentPage","pageSize","total","value","length","type","region","searchWord","getMovies","then","res","code","data","records","catch","err","keywords","currentRoute","query","undefined","newValue","oldValue","document","body","scrollTop","documentElement","window","scrollTo","on","searchKeywords","isCard","listColor","gridColor","handleSwitch","val","off"],"sourceRoot":"","sources":["F:\\personalSpace\\lx-bishe\\movie_recommendation_system_vue\\src\\components\\classification\\MovieCards.vue"],"sourcesContent":["<template>\r\n  <div class=\"movie-cards-master my-border\">\r\n    <!-- 电影 卡片 or 长条 开关 -->\r\n    <div class=\"card-or-strip-switch\">\r\n      <el-icon>\r\n        <icon-list :color=\"listColor\"/>\r\n      </el-icon>\r\n\r\n      <el-switch\r\n          v-model=\"isCard\"\r\n          active-color=\"#13ce66\"\r\n          inactive-color=\"#36a4ff\"\r\n          :active-value=\"true\"\r\n          :inactive-value=\"false\"\r\n          @change=\"handleSwitch\"\r\n      />\r\n\r\n      <el-icon>\r\n        <icon-grid :color=\"gridColor\"/>\r\n      </el-icon>\r\n    </div>\r\n\r\n    <el-skeleton :loading=\"loading && isCard\" style=\"width: 25rem; margin-left: 1rem\" animated>\r\n      <template #template>\r\n        <el-skeleton-item variant=\"image\" style=\"width: 13.8rem; height: 19.8rem\" />\r\n        <div style=\"padding-top: 1rem; padding-bottom: 1rem;\">\r\n          <el-skeleton-item variant=\"p\" style=\"width: 8rem; text-align: center\" />\r\n          <br/>\r\n          <el-skeleton-item variant=\"p\" style=\"width: 13.8rem\" />\r\n        </div>\r\n      </template>\r\n    </el-skeleton>\r\n\r\n    <el-skeleton\r\n        style=\"width: 94%; padding-left: 3%\"\r\n        :loading=\"loading && !isCard\"\r\n        :rows=\"5\"\r\n        animated/>\r\n\r\n    <blank-page v-if=\"!movies.length && !loading\" page-name=\"movie\"></blank-page>\r\n\r\n    <!-- 电影卡片显示 -->\r\n    <div v-show=\"isCard\" class=\"movie-cards\">\r\n      <template\r\n          v-for=\"movie in movies\"\r\n          :key=\"movie.id\">\r\n        <movie-card class=\"card\" :movie=\"movie\"></movie-card>\r\n      </template>\r\n    </div>\r\n\r\n    <!-- 电影长条显示 -->\r\n    <div v-show=\"!isCard\" class=\"movie-strips\">\r\n      <template\r\n          v-for=\"movie in movies\"\r\n          :key=\"movie.id\">\r\n        <movie-strip class=\"strip\" :movie=\"movie\"></movie-strip>\r\n\r\n      </template>\r\n    </div>\r\n\r\n    <!-- 分页 样式1-->\r\n    <div v-show=\"total > 12\" class=\"pagination-style-first\">\r\n      <el-pagination\r\n          style=\"justify-content: center\"\r\n          v-model:currentPage=\"currentPage\"\r\n          v-model:page-size=\"pageSize\"\r\n          v-model:total=\"total\"\r\n          :pager-count=\"7\"\r\n          background\r\n          layout=\"total, prev, pager, next, jumper\"\r\n      />\r\n    </div>\r\n\r\n    <!-- 分页 样式2 -->\r\n    <div v-show=\"total > 12\" class=\"pagination-style-second\">\r\n      <el-pagination\r\n          style=\"justify-content: center\"\r\n          v-model:currentPage=\"currentPage\"\r\n          v-model:page-size=\"pageSize\"\r\n          v-model:total=\"total\"\r\n          :pager-count=\"5\"\r\n          small\r\n          background\r\n          layout=\"prev, pager, next, jumper\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {PictureRounded, Menu as IconMenu, Grid as IconGrid, List as IconList} from \"@element-plus/icons-vue\";\r\nimport MovieCard from \"@/components/basic/MovieCard\";\r\nimport {onBeforeUnmount, onMounted, reactive, ref, toRaw, watch} from \"vue\";\r\nimport MovieStrip from \"@/components/basic/MovieStrip\";\r\nimport emitter from \"@/utils/event-bus\";\r\nimport movieRequest from \"@/api/movie\";\r\nimport {ErrorMessage} from \"@/utils/my-message\";\r\nimport {useRouter} from \"vue-router\";\r\nimport BlankPage from \"@/components/basic/BlankPage\";\r\n\r\nexport default {\r\n  // 这里用来纪念一下困扰我多天的低级错误，把MovieCard.vue 和 MovieCards.vue的name都写成了MovieCard，导致递归堆栈溢出问题！！！\r\n  name: \"MovieCards\",\r\n  components: {\r\n    BlankPage,\r\n    IconMenu,\r\n    IconGrid,\r\n    IconList,\r\n    PictureRounded,\r\n    MovieCard,\r\n    MovieStrip\r\n  },\r\n  setup() {\r\n    const router = useRouter()\r\n\r\n    let loading = ref(false);\r\n\r\n    // 分页结果，电影列表\r\n    let movies = ref([]);\r\n\r\n    // 分页查询需要用到的一些数据\r\n    let currentPage = ref(1); // 当前页码\r\n    let pageSize = ref(12);   // 每页电影数量\r\n    let total = ref(movies.value.length); // 总电影数\r\n    let type = ref('全部');    // 电影类型\r\n    let region = ref('全部');  // 电影地区\r\n    let searchWord = ref('');  // 搜索关键字\r\n\r\n    /**\r\n     * 向服务器请求电影数据\r\n     */\r\n    let getMovies = () => {\r\n      loading.value = true;\r\n      movies.value = []\r\n      movieRequest.getMovies(\r\n          currentPage.value,\r\n          pageSize.value,\r\n          type.value,\r\n          region.value,\r\n          searchWord.value\r\n      ).then(res => {\r\n        if (res.code === 200) {\r\n          movies.value = res.data.records;\r\n          total.value = res.data.total;\r\n        }\r\n        loading.value = false;\r\n      }).catch(err => {\r\n        ErrorMessage(err)\r\n      })\r\n    }\r\n\r\n    // 初始化页面时，获取电影信息列表\r\n    let keywords = ref(router.currentRoute.value.query.keywords)\r\n    onMounted(() => {\r\n      if (keywords.value === undefined) {\r\n        getMovies()\r\n      } else {\r\n        searchWord.value = keywords.value\r\n        getMovies()\r\n      }\r\n    })\r\n\r\n\r\n    /**\r\n     * 监听`当前页码`变化\r\n     * 若页码发生变化，重新请求电影数据，随后页面发生变化。\r\n     */\r\n    watch(currentPage, (newValue, oldValue) => {\r\n      // 页面回到顶部（兼容不同浏览器）\r\n      document.body.scrollTop = 0;\r\n      document.documentElement.scrollTop = 0;\r\n      window.scrollTo(0, 0);\r\n\r\n      getMovies()\r\n    });\r\n\r\n    /**\r\n     * 监听`每页电影数量`变化（可扩展）\r\n     * 若发生变化，重新请求电影数据，随后页面发生变化。\r\n     */\r\n    watch(pageSize, (newValue, oldValue) => {\r\n\r\n    })\r\n\r\n    /**\r\n     * 全局事件总线\r\n     * 监听MovieTags.vue中的type和region的变化\r\n     */\r\n    emitter.on('handleTypeOrRegionChange', data => {\r\n      type.value = data.type;\r\n      region.value = data.region;\r\n      currentPage.value = 1;\r\n      getMovies();\r\n    })\r\n\r\n    /**\r\n     * 全局事件总线\r\n     * 监听MovieHeader.vue中的keywords变化\r\n     */\r\n    emitter.on('handleSearch', data => {\r\n      searchWord.value = data.searchKeywords\r\n      getMovies()\r\n    })\r\n\r\n    // 电影 卡片 or 长条 开关值，true为卡片，false为长条\r\n    let isCard = ref(true);\r\n    let listColor = ref('');\r\n    let gridColor = ref('#13ce66');\r\n    let handleSwitch = val => {\r\n      if (!val) {\r\n        listColor.value = '#36a4ff';\r\n        gridColor.value = '';\r\n      } else {\r\n        listColor.value = '';\r\n        gridColor.value = '#13ce66';\r\n      }\r\n    }\r\n\r\n    onBeforeUnmount(() => {\r\n      emitter.off('handleTypeOrRegionChange');\r\n      emitter.off('handleSearch')\r\n    })\r\n\r\n    return {\r\n      loading,\r\n      pageSize,\r\n      currentPage,\r\n      total,\r\n      movies,\r\n      isCard,\r\n      listColor,\r\n      gridColor,\r\n      getMovies,\r\n      handleSwitch,\r\n    }\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.movie-cards-master {\r\n  margin-bottom: 1rem;\r\n}\r\n\r\n/* 卡片or长条开关样式 */\r\n.card-or-strip-switch {\r\n  display: flex;\r\n  justify-content: right;\r\n  align-items: center;\r\n  margin-right: 2rem;\r\n  margin-top: 0.3rem;\r\n}\r\n\r\n/* 电影卡片样式 */\r\n.movie-cards {\r\n  display: grid;\r\n  justify-content: space-evenly;\r\n  grid-template-columns: repeat(auto-fill, 13.8rem);\r\n\r\n  .card {\r\n    margin-top: 0.3rem;\r\n  }\r\n}\r\n\r\n/* 电影长条样式 */\r\n.movie-strips {\r\n  margin-left: 3rem;\r\n  margin-right: 3rem;\r\n\r\n  .strip {\r\n    margin-top: 0.3rem;\r\n    margin-bottom: 1rem;\r\n  }\r\n}\r\n\r\n\r\n/* 分页模块样式 */\r\n.pagination-style-first, .pagination-style-second {\r\n  margin: 1rem 0;\r\n}\r\n\r\n.pagination-style-first {\r\n  display: block;\r\n}\r\n\r\n.pagination-style-second {\r\n  display: none;\r\n}\r\n\r\n@media screen and (max-width: 1000px) {\r\n  .pagination-style-first {\r\n    display: none;\r\n  }\r\n\r\n  .pagination-style-second {\r\n    display: block;\r\n  }\r\n\r\n  .movie-strips {\r\n    margin-left: 1rem;\r\n    margin-right: 1rem;\r\n  }\r\n}\r\n\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}