{"ast":null,"code":"import { getCurrentInstance, ref, watchEffect, computed, unref, h } from 'vue';\nimport '../../../../utils/index.mjs';\nimport '../../../../hooks/index.mjs';\nimport { cellForced, getDefaultClassName, defaultRenderCell, treeCellPrefix } from '../config.mjs';\nimport { parseWidth, parseMinWidth } from '../util.mjs';\nimport { useNamespace } from '../../../../hooks/use-namespace/index.mjs';\nimport { debugWarn } from '../../../../utils/error.mjs';\nfunction useRender(props, slots, owner) {\n  const instance = getCurrentInstance();\n  const columnId = ref(\"\");\n  const isSubColumn = ref(false);\n  const realAlign = ref();\n  const realHeaderAlign = ref();\n  const ns = useNamespace(\"table\");\n  watchEffect(() => {\n    realAlign.value = props.align ? `is-${props.align}` : null;\n    realAlign.value;\n  });\n  watchEffect(() => {\n    realHeaderAlign.value = props.headerAlign ? `is-${props.headerAlign}` : realAlign.value;\n    realHeaderAlign.value;\n  });\n  const columnOrTableParent = computed(() => {\n    let parent = instance.vnode.vParent || instance.parent;\n    while (parent && !parent.tableId && !parent.columnId) {\n      parent = parent.vnode.vParent || parent.parent;\n    }\n    return parent;\n  });\n  const realWidth = ref(parseWidth(props.width));\n  const realMinWidth = ref(parseMinWidth(props.minWidth));\n  const setColumnWidth = column => {\n    if (realWidth.value) column.width = realWidth.value;\n    if (realMinWidth.value) {\n      column.minWidth = realMinWidth.value;\n    }\n    if (!column.minWidth) {\n      column.minWidth = 80;\n    }\n    column.realWidth = Number(column.width === void 0 ? column.minWidth : column.width);\n    return column;\n  };\n  const setColumnForcedProps = column => {\n    const type = column.type;\n    const source = cellForced[type] || {};\n    Object.keys(source).forEach(prop => {\n      const value = source[prop];\n      if (prop !== \"className\" && value !== void 0) {\n        column[prop] = value;\n      }\n    });\n    const className = getDefaultClassName(type);\n    if (className) {\n      const forceClass = `${unref(ns.namespace)}-${className}`;\n      column.className = column.className ? `${column.className} ${forceClass}` : forceClass;\n    }\n    return column;\n  };\n  const checkSubColumn = children => {\n    if (Array.isArray(children)) {\n      children.forEach(child => check(child));\n    } else {\n      check(children);\n    }\n    function check(item) {\n      var _a;\n      if (((_a = item == null ? void 0 : item.type) == null ? void 0 : _a.name) === \"ElTableColumn\") {\n        item.vParent = instance;\n      }\n    }\n  };\n  const setColumnRenders = column => {\n    if (props.renderHeader) {\n      debugWarn(\"TableColumn\", \"Comparing to render-header, scoped-slot header is easier to use. We recommend users to use scoped-slot header.\");\n    } else if (column.type !== \"selection\") {\n      column.renderHeader = scope => {\n        instance.columnConfig.value[\"label\"];\n        const renderHeader = slots.header;\n        return renderHeader ? renderHeader(scope) : column.label;\n      };\n    }\n    let originRenderCell = column.renderCell;\n    if (column.type === \"expand\") {\n      column.renderCell = data => h(\"div\", {\n        class: \"cell\"\n      }, [originRenderCell(data)]);\n      owner.value.renderExpanded = data => {\n        return slots.default ? slots.default(data) : slots.default;\n      };\n    } else {\n      originRenderCell = originRenderCell || defaultRenderCell;\n      column.renderCell = data => {\n        let children = null;\n        if (slots.default) {\n          children = slots.default(data);\n        } else {\n          children = originRenderCell(data);\n        }\n        const prefix = treeCellPrefix(data);\n        const props2 = {\n          class: \"cell\",\n          style: {}\n        };\n        if (column.showOverflowTooltip) {\n          props2.class = `${props2.class} ${unref(ns.namespace)}-tooltip`;\n          props2.style = {\n            width: `${(data.column.realWidth || Number(data.column.width)) - 1}px`\n          };\n        }\n        checkSubColumn(children);\n        return h(\"div\", props2, [prefix, children]);\n      };\n    }\n    return column;\n  };\n  const getPropsData = (...propsKey) => {\n    return propsKey.reduce((prev, cur) => {\n      if (Array.isArray(cur)) {\n        cur.forEach(key => {\n          prev[key] = props[key];\n        });\n      }\n      return prev;\n    }, {});\n  };\n  const getColumnElIndex = (children, child) => {\n    return Array.prototype.indexOf.call(children, child);\n  };\n  return {\n    columnId,\n    realAlign,\n    isSubColumn,\n    realHeaderAlign,\n    columnOrTableParent,\n    setColumnWidth,\n    setColumnForcedProps,\n    setColumnRenders,\n    getPropsData,\n    getColumnElIndex\n  };\n}\nexport { useRender as default };","map":{"version":3,"mappings":"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","names":["useRender","props","slots","owner","instance","getCurrentInstance","columnId","ref","isSubColumn","realAlign","realHeaderAlign","ns","useNamespace","watchEffect","value","align","headerAlign","columnOrTableParent","computed","parent","vnode","vParent","tableId","realWidth","parseWidth","width","realMinWidth","parseMinWidth","minWidth","setColumnWidth","column","Number","setColumnForcedProps","type","source","cellForced","Object","keys","forEach","prop","className","getDefaultClassName","forceClass","unref","namespace","checkSubColumn","children","Array","isArray","child","check","item","_a","name","setColumnRenders","renderHeader","debugWarn","scope","columnConfig","header","label","originRenderCell","renderCell","data","h","class","renderExpanded","default","defaultRenderCell","prefix","treeCellPrefix","props2","style","showOverflowTooltip","getPropsData","propsKey","reduce","prev","cur","key","getColumnElIndex","prototype","indexOf","call"],"sources":["../../../../../../../packages/components/table/src/table-column/render-helper.ts"],"sourcesContent":["import { getCurrentInstance, h, ref, computed, watchEffect, unref } from 'vue'\nimport { debugWarn } from '@element-plus/utils'\nimport { useNamespace } from '@element-plus/hooks'\nimport {\n  cellForced,\n  defaultRenderCell,\n  treeCellPrefix,\n  getDefaultClassName,\n} from '../config'\nimport { parseWidth, parseMinWidth } from '../util'\n\nimport type { ComputedRef } from 'vue'\nimport type { TableColumnCtx, TableColumn } from './defaults'\n\nfunction useRender<T>(\n  props: TableColumnCtx<T>,\n  slots,\n  owner: ComputedRef<any>\n) {\n  const instance = getCurrentInstance() as TableColumn<T>\n  const columnId = ref('')\n  const isSubColumn = ref(false)\n  const realAlign = ref<string>()\n  const realHeaderAlign = ref<string>()\n  const ns = useNamespace('table')\n  watchEffect(() => {\n    realAlign.value = props.align ? `is-${props.align}` : null\n    // nextline help render\n    realAlign.value\n  })\n  watchEffect(() => {\n    realHeaderAlign.value = props.headerAlign\n      ? `is-${props.headerAlign}`\n      : realAlign.value\n    // nextline help render\n    realHeaderAlign.value\n  })\n  const columnOrTableParent = computed(() => {\n    let parent: any = instance.vnode.vParent || instance.parent\n    while (parent && !parent.tableId && !parent.columnId) {\n      parent = parent.vnode.vParent || parent.parent\n    }\n    return parent\n  })\n\n  const realWidth = ref(parseWidth(props.width))\n  const realMinWidth = ref(parseMinWidth(props.minWidth))\n  const setColumnWidth = (column: TableColumnCtx<T>) => {\n    if (realWidth.value) column.width = realWidth.value\n    if (realMinWidth.value) {\n      column.minWidth = realMinWidth.value\n    }\n    if (!column.minWidth) {\n      column.minWidth = 80\n    }\n    column.realWidth = Number(\n      column.width === undefined ? column.minWidth : column.width\n    )\n    return column\n  }\n  const setColumnForcedProps = (column: TableColumnCtx<T>) => {\n    // 对于特定类型的 column，某些属性不允许设置\n    const type = column.type\n    const source = cellForced[type] || {}\n    Object.keys(source).forEach((prop) => {\n      const value = source[prop]\n      if (prop !== 'className' && value !== undefined) {\n        column[prop] = value\n      }\n    })\n    const className = getDefaultClassName(type)\n    if (className) {\n      const forceClass = `${unref(ns.namespace)}-${className}`\n      column.className = column.className\n        ? `${column.className} ${forceClass}`\n        : forceClass\n    }\n    return column\n  }\n\n  const checkSubColumn = (children: TableColumn<T> | TableColumn<T>[]) => {\n    if (Array.isArray(children)) {\n      children.forEach((child) => check(child))\n    } else {\n      check(children)\n    }\n    function check(item: TableColumn<T>) {\n      if (item?.type?.name === 'ElTableColumn') {\n        item.vParent = instance\n      }\n    }\n  }\n  const setColumnRenders = (column: TableColumnCtx<T>) => {\n    // renderHeader 属性不推荐使用。\n    if (props.renderHeader) {\n      debugWarn(\n        'TableColumn',\n        'Comparing to render-header, scoped-slot header is easier to use. We recommend users to use scoped-slot header.'\n      )\n    } else if (column.type !== 'selection') {\n      column.renderHeader = (scope) => {\n        // help render\n        instance.columnConfig.value['label']\n        const renderHeader = slots.header\n        return renderHeader ? renderHeader(scope) : column.label\n      }\n    }\n\n    let originRenderCell = column.renderCell\n    // TODO: 这里的实现调整\n    if (column.type === 'expand') {\n      // 对于展开行，renderCell 不允许配置的。在上一步中已经设置过，这里需要简单封装一下。\n      column.renderCell = (data) =>\n        h(\n          'div',\n          {\n            class: 'cell',\n          },\n          [originRenderCell(data)]\n        )\n      owner.value.renderExpanded = (data) => {\n        return slots.default ? slots.default(data) : slots.default\n      }\n    } else {\n      originRenderCell = originRenderCell || defaultRenderCell\n      // 对 renderCell 进行包装\n      column.renderCell = (data) => {\n        let children = null\n        if (slots.default) {\n          children = slots.default(data)\n        } else {\n          children = originRenderCell(data)\n        }\n        const prefix = treeCellPrefix(data)\n        const props = {\n          class: 'cell',\n          style: {},\n        }\n        if (column.showOverflowTooltip) {\n          props.class = `${props.class} ${unref(ns.namespace)}-tooltip`\n          props.style = {\n            width: `${\n              (data.column.realWidth || Number(data.column.width)) - 1\n            }px`,\n          }\n        }\n        checkSubColumn(children)\n        return h('div', props, [prefix, children])\n      }\n    }\n    return column\n  }\n  const getPropsData = (...propsKey: unknown[]) => {\n    return propsKey.reduce((prev, cur) => {\n      if (Array.isArray(cur)) {\n        cur.forEach((key) => {\n          prev[key] = props[key]\n        })\n      }\n      return prev\n    }, {})\n  }\n  const getColumnElIndex = (children, child) => {\n    return Array.prototype.indexOf.call(children, child)\n  }\n\n  return {\n    columnId,\n    realAlign,\n    isSubColumn,\n    realHeaderAlign,\n    columnOrTableParent,\n    setColumnWidth,\n    setColumnForcedProps,\n    setColumnRenders,\n    getPropsData,\n    getColumnElIndex,\n  }\n}\n\nexport default useRender\n"]},"metadata":{},"sourceType":"module"}